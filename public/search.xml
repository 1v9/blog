<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Debian å®‰è£… HAProxy</title>
    <url>/post/debian-install-haproxy.html</url>
    <content><![CDATA[<p><a href="https://www.haproxy.org/">HAProxy</a> æ˜¯ä¸€æ¬¾è€è€Œå¼¥åšçš„ TCP/HTTP è´Ÿè½½å‡è¡¡ï¼Œå¼€å‘ç›¸å½“æ´»è·ƒã€‚<br>æœ¬æ–‡å°†ç®€å•ä»‹ç» Debian ç³»ç»Ÿå®‰è£… HAProxy çš„ä¸¤ç§æ–¹å¼ï¼Œå³åŒ…ç®¡ç†ä¸ç¼–è¯‘å®‰è£…ã€‚<br>Ubuntu ç”¨æˆ·ä¹Ÿå¯ä»¥å‚è€ƒï¼Œæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚<a id="more"></a></p>
<h1 id="åŒ…ç®¡ç†å®‰è£…"><a href="#åŒ…ç®¡ç†å®‰è£…" class="headerlink" title="åŒ…ç®¡ç†å®‰è£…"></a>åŒ…ç®¡ç†å®‰è£…</h1><p>æ²¡æœ‰ç‰¹æ®Šéœ€æ±‚å¯ä»¥ç›´æ¥é€šè¿‡åŒ…ç®¡ç†å·¥å…·ä¹Ÿå°±æ˜¯ apt å®‰è£… HAProxyï¼Œå…·ä½“æ­¥éª¤å‚è€ƒ <a href="https://haproxy.debian.net/#?distribution=Debian&release=stretch&version=1.9">Debian/Ubuntu HAProxy packages</a> å³å¯ã€‚<br>å¦‚éœ€å¯ç”¨ TLS 1.3 åˆ™éœ€è¦è‡ªè¡Œä½¿ç”¨ openssl 1.1.1 ä»¥ä¸Šåˆ†æ”¯ç¼–è¯‘ã€‚<br>è¯·ç»§ç»­é˜…è¯»ä¸‹æ–‡æˆ‘ä¸ªäººçš„ç¼–è¯‘è¿‡ç¨‹ã€‚æ¯ä¸ªäººéœ€æ±‚ä¸åŒï¼Œæ‰€ä»¥ä»…ä¾›å‚è€ƒã€‚</p>
<h1 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><blockquote>
<p>å¦‚æœä¸ªåˆ«åŒ…æç¤ºå†²çªï¼Œå¯èƒ½æ˜¯å› ä¸ºåŒ…æ¥æºä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦ç»Ÿä¸€ä½¿ç”¨ backports æˆ– é»˜è®¤æºè¿›è¡Œå®‰è£…ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install build-essential libpcre2-dev zlib1g-dev libsystemd-dev liblua5.3-dev</span><br></pre></td></tr></table></figure>

<h3 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.1d.tar.gz</span><br><span class="line">tar -xzf openssl-1.1.1d.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1d</span><br><span class="line"><span class="comment"># ç¦ç”¨åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">./config --prefix=/opt/openssl-1.1.1d no-shared</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; rm -rf openssl-1.1.1d*</span><br></pre></td></tr></table></figure>

<h2 id="å¼€å§‹ç¼–è¯‘"><a href="#å¼€å§‹ç¼–è¯‘" class="headerlink" title="å¼€å§‹ç¼–è¯‘"></a>å¼€å§‹ç¼–è¯‘</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ HAProxy ç‰ˆæœ¬ï¼Œç›®å‰ä¸»è¦åˆ†æ”¯ä¸º 2.1</span></span><br><span class="line">HAPROXY_MAJOR=2.1</span><br><span class="line">HAPROXY_VERSION=2.1.2</span><br><span class="line"><span class="comment"># åŸºç¡€çš„ç¼–è¯‘å‚æ•°ï¼Œä½¿ç”¨ gcc ç¼–è¯‘çš„è¯ç§»é™¤ CC=clang å³å¯</span></span><br><span class="line">CC=clang</span><br><span class="line">CPU=x86-64</span><br><span class="line">TARGET=linux-glibc</span><br><span class="line">PREFIX=/usr/<span class="built_in">local</span>/haproxy</span><br><span class="line"><span class="comment"># åˆ›å»ºå¹¶è¿›å…¥å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> &amp;&amp; mkdir HAProxy &amp;&amp; <span class="built_in">cd</span> HAProxy</span><br><span class="line"><span class="comment"># ä¸‹è½½ malloc åŠ HAProxy æºç </span></span><br><span class="line">wget -4 ftp://gee.cs.oswego.edu/pub/misc/malloc.c</span><br><span class="line">wget -4 <span class="string">&quot;http://www.haproxy.org/download/<span class="variable">$&#123;HAPROXY_MAJOR&#125;</span>/src/haproxy-<span class="variable">$&#123;HAPROXY_VERSION&#125;</span>.tar.gz&quot;</span></span><br><span class="line">tar -xzf haproxy-<span class="variable">$&#123;HAPROXY_VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> haproxy-<span class="variable">$&#123;HAPROXY_VERSION&#125;</span></span><br><span class="line"><span class="comment"># æ­¤å¤„å¯é€šè¿‡ make help è·å–å…¨éƒ¨å‚æ•°è¯´æ˜ï¼ŒåŠ¡å¿…ä»”ç»†é˜…è¯»</span></span><br><span class="line">make \</span><br><span class="line">CC=<span class="variable">$CC</span> \</span><br><span class="line">CPU=<span class="variable">$CPU</span> \</span><br><span class="line">TARGET=<span class="variable">$TARGET</span> \</span><br><span class="line">PREFIX=<span class="variable">$PREFIX</span> \</span><br><span class="line">USE_DLMALLOC=1 \</span><br><span class="line">USE_PCRE2=1 \</span><br><span class="line">USE_PCRE2_JIT=1 \</span><br><span class="line">USE_THREAD=1 \</span><br><span class="line">USE_PTHREAD_PSHARED=1 \</span><br><span class="line">USE_LIBCRYPT=1 \</span><br><span class="line">USE_GETADDRINFO=1 \</span><br><span class="line">USE_OPENSSL=1 \</span><br><span class="line">USE_LUA=1 \</span><br><span class="line">USE_ZLIB=1 \</span><br><span class="line">USE_TFO=1 \</span><br><span class="line">USE_NS=1 \</span><br><span class="line">USE_SYSTEMD=1 \</span><br><span class="line">DLMALLOC_SRC=../malloc.c \</span><br><span class="line">SSL_LIB=/opt/openssl-1.1.1a/lib \</span><br><span class="line">SSL_INC=/opt/openssl-1.1.1a/include</span><br><span class="line">make install PREFIX=<span class="variable">$PREFIX</span></span><br><span class="line">install -d /usr/sbin</span><br><span class="line">install haproxy /usr/sbin</span><br><span class="line">install -d /usr/<span class="built_in">local</span>/share/man/man1  </span><br><span class="line">install -m 644 doc/haproxy.1 /usr/<span class="built_in">local</span>/share/man/man1</span><br><span class="line">cp -ar <span class="variable">$PREFIX</span>/doc/haproxy  /usr/<span class="built_in">local</span>/doc/haproxy</span><br><span class="line">mkdir -pv /var/lib/haproxy</span><br><span class="line"><span class="built_in">cd</span> &amp;&amp; rm -rf HAProxy</span><br></pre></td></tr></table></figure>

<h2 id="éªŒè¯-HAProxy"><a href="#éªŒè¯-HAProxy" class="headerlink" title="éªŒè¯ HAProxy"></a>éªŒè¯ HAProxy</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾äºŒè¿›åˆ¶æ–‡ä»¶å¹¶è·å–ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">which</span> haproxy &amp;&amp; haproxy -vv</span><br></pre></td></tr></table></figure>

<h1 id="æ”¶å·¥"><a href="#æ”¶å·¥" class="headerlink" title="æ”¶å·¥"></a>æ”¶å·¥</h1><p>é‡äº‹ä¸å†³è¯·æŸ¥é˜…æ–‡æ¡£ï¼Œman haproxy çš„è¯è¿˜æ˜¯è®©äººå¤´å¤§ã€‚<br>å»ºè®®è®¿é—® <a href="https://cbonte.github.io/haproxy-dconv/">cbonte</a>ï¼Œå†…æœ‰ HAProxy å…¨å®¶æ¡¶ã€‚</p>
]]></content>
      <categories>
        <category>HAProxy</category>
      </categories>
      <tags>
        <tag>Debian</tag>
        <tag>TLS 1.3</tag>
      </tags>
  </entry>
  <entry>
    <title>NexT æ·»åŠ ä»Šæ—¥è¯—è¯</title>
    <url>/post/add-today-poetry-for-theme-next.html</url>
    <content><![CDATA[<p><a href="https://www.jinrishici.com/">ä»Šæ—¥è¯—è¯</a>çš„è°ƒç”¨å¹¶ä¸å¤æ‚ï¼Œä¹‹å‰ä½¿ç”¨çš„ <code>footer.custom_text</code> é€‰é¡¹ç”±äº <a href="https://github.com/theme-next/hexo-theme-next/pull/868">theme_inject</a> çš„åˆå¹¶å·²ç»åºŸå¼ƒï¼Œæ‰€ä»¥å¯¹æœ¬æ–‡è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œå¦å¤–å°†æ ‡ç­¾è½¬ç§»åˆ°äº†æ­£æ–‡ç»“æŸçš„ä½ç½®ã€‚<a id="more"></a></p>
<h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><p>é¦–å…ˆé€šè¿‡ <code>_config.yml</code> å¯ç”¨é€‰é¡¹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="attr">postBodyEnd:</span> <span class="string">source/_data/post-body-end.swig</span></span><br><span class="line">  <span class="attr">bodyEnd:</span> <span class="string">source/_data/body-end.swig</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>

<h1 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h1><p>æœ€åŸºç¡€çš„è®¾ç½®å‚è€ƒ <a href="https://www.jinrishici.com/doc/#json-fast-easy">é€šç”¨ç®€å•å®‰è£…ä»£ç </a>ã€‚</p>
<p>é¦–å…ˆåœ¨ <code>source/_data/body-end.swig</code> æ–‡ä»¶å†…å¼•å…¥ä»Šæ—¥è¯—è¯çš„ SDKï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://sdk.jinrishici.com/v2/browser/jinrishici.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ <code>source/_data/post-body-end.swig</code> æ–‡ä»¶å†…æ”¾å…¥æ ‡ç­¾ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;jinrishici-sentence&quot;</span>&gt;</span>æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="é«˜çº§ä½¿ç”¨"><a href="#é«˜çº§ä½¿ç”¨" class="headerlink" title="é«˜çº§ä½¿ç”¨"></a>é«˜çº§ä½¿ç”¨</h1><p>ç®€å•ä½¿ç”¨çš„è¯ä¸æ˜¾ç¤ºä½œè€…ã€æœä»£ç­‰ä¿¡æ¯ï¼Œå‚è€ƒ <a href="https://www.jinrishici.com/doc/#json-fast-custom">é€šç”¨é«˜çº§å®‰è£…ä»£ç </a> ä»¥åŠ <a href="https://www.jinrishici.com/doc/#return">æ¥å£è¿”å›ç»“æœæ ¼å¼</a>ï¼Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯è¿™ä¸€å¥è¯ï¼š</p>
<div class="note info"><p>ä½¿ç”¨å®šåˆ¶åŠ è½½æ—¶ï¼Œä¸è¦å°†æ ‡ç­¾çš„ id æˆ–è€… class è®¾ç½®ä¸º jinrishici-sentence ï¼Œå¦åˆ™SDKä¼šè‡ªåŠ¨åŠ è½½ä¸€æ¬¡ã€‚</p>
</div>

<p>ä¹Ÿå°±æ˜¯è¯´æ’å…¥çš„æ ‡ç­¾ä¸åº”è¯¥ä½¿ç”¨ä¹‹å‰çš„ <strong>jinrishici-sentence</strong>ï¼Œéœ€è¦é‡æ–°å‘½åã€‚å‚è€ƒä¸Šä¸€èŠ‚é…ç½®çš„ä¸¤ä¸ªæ–‡ä»¶ï¼ŒæŠŠå†…å®¹ä¿®æ”¹ä¸€ä¸‹å³å¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//sdk.jinrishici.com/v2/browser/jinrishici.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">&#x27;ä»Šæ—¥è¯—è¯ - å¼€å§‹åŠ è½½...&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  jinrishici.load(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> jrsc = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;jrsc&#x27;</span>);</span></span><br><span class="line">    if (jrsc) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;ä»Šæ—¥è¯—è¯ - æ ‡ç­¾è·å–æˆåŠŸ.&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;ä»Šæ—¥è¯—è¯ - æ ‡ç­¾è·å–å¤±è´¥!&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> data = result.data;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> author = data.origin.author;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> title = <span class="string">&#x27;ã€Š&#x27;</span> + data.origin.title + <span class="string">&#x27;ã€‹&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> content = data.content.substr(<span class="number">0</span>, data.content.length - <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> dynasty = data.origin.dynasty.substr(<span class="number">0</span>, data.origin.dynasty.length - <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">    jrsc.innerText = content + <span class="string">&#x27; @ &#x27;</span> + dynasty + <span class="string">&#x27;Â·&#x27;</span> + author + title;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&#x27;ä»Šæ—¥è¯—è¯ - è½½å…¥å®Œæ¯•.&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (data.origin.author == <span class="string">&#x27;æç™½&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> audio = <span class="built_in">document</span>.createElement(<span class="string">&quot;audio&quot;</span>);</span></span><br><span class="line"><span class="javascript">      audio.src = <span class="string">&quot;/ding.mp3&quot;</span>;</span></span><br><span class="line">      audio.play();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;jrsc&quot;</span> &gt;</span>æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="æ ‡ç­¾æ ·å¼"><a href="#æ ‡ç­¾æ ·å¼" class="headerlink" title="æ ‡ç­¾æ ·å¼"></a>æ ‡ç­¾æ ·å¼</h1><p>NexT æ”¯æŒè‡ªå®šä¹‰æ ·å¼ï¼Œåœ¨ <code>source/_data/styles.styl</code> å†…å†™å…¥å¦‚ä¸‹å†…å®¹ï¼Œè¯·è‡ªè¡Œå‘æŒ¥ï¼š</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#jrsc</span> &#123;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">  <span class="attribute">font-size</span>: initial;</span><br><span class="line">  <span class="attribute">color</span>: midnightblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ„å¤–"><a href="#æ„å¤–" class="headerlink" title="æ„å¤–"></a>æ„å¤–</h1><p>å› ä¸ºä»Šæ—¥è¯—è¯æ˜¯ç½‘é¡µå®¢æˆ·ç«¯è°ƒç”¨ä»¥åŠå®ƒæœ¬èº«çš„åœ°ç†æ¨èæœºåˆ¶ï¼Œæˆ‘ç«Ÿç„¶è¢« ã€Šæ˜¥æ±ŸèŠ±æœˆå¤œã€‹ å›°ä½äº†ï¼ŒğŸ˜‚ã€‚</p>
]]></content>
      <categories>
        <category>NexT</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
      </tags>
  </entry>
  <entry>
    <title>Pixiv æ¼«ç”»ä¸‹è½½è„šæœ¬</title>
    <url>/post/pixiv-manga-download-script.html</url>
    <content><![CDATA[<p>è¿™æ˜¯æˆ‘ç¼–å†™çš„ä¸€ä¸ªä½æ™ºèƒ½çš„ç”¨æ¥ä¸‹è½½ pixiv æ¼«ç”»çš„ Bash è„šæœ¬ï¼Œéœ€è¦è¾“å…¥æ¼«ç”»å›¾ç‰‡çš„å‡†ç¡®æ•°é‡ä»¥åŠç¬¬ä¸€å¼ æ¼«ç”»å›¾ç‰‡çš„å®Œæ•´åœ°å€ï¼Œä¾èµ– <a href="https://github.com/axel-download-accelerator/axel">Axel</a> ä¸ <a href="https://www.perl.org/">Perl</a>ã€‚<a id="more"></a></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ç›®å‰å·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„ pixiv çˆ¬å–å·¥å…·ï¼Œåˆ©ç”¨ Pyhtonã€JavaScript ç­‰ç­‰ï¼Œä½†æ˜¯æˆ‘æ‹’ç»ã€‚Bash æŒ‰é¡ºåºæ‰§è¡Œçš„ç‰¹ç‚¹å¤ªé€‚åˆæˆ‘è¿™æ ·çš„éç¼–ç¨‹äººå£«äº†ã€‚</p>
<h1 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/<span class="built_in">local</span>/bin:/usr/<span class="built_in">local</span>/sbin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ ·å¼</span></span><br><span class="line">Info_font=<span class="string">&#x27;\e[32;49;1m&#x27;</span></span><br><span class="line">Warning_font=<span class="string">&#x27;\033[31m&#x27;</span></span><br><span class="line">Font_color=<span class="string">&#x27;\033[39;49;0m&#x27;</span></span><br><span class="line">Info=<span class="string">&quot;<span class="variable">$&#123;Info_font&#125;</span>[ä¿¡æ¯]<span class="variable">$&#123;Font_color&#125;</span>&quot;</span></span><br><span class="line">Warning=<span class="string">&quot;<span class="variable">$&#123;Warning_font&#125;</span>[è­¦å‘Š]<span class="variable">$&#123;Font_color&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æµ‹ axelã€perl</span></span><br><span class="line"><span class="built_in">type</span> axel &gt;/dev/null 2&gt;&amp;1 || &#123; <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Warning&#125;</span> è¯·æ£€æŸ¥ axel!&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="built_in">type</span> perl &gt;/dev/null 2&gt;&amp;1 || &#123; <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Warning&#125;</span> è¯·æ£€æŸ¥ perl!&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–è¾“å…¥</span></span><br><span class="line"><span class="comment">#read -p &quot;è¯·è¾“å…¥å›¾ç‰‡æ•°é‡ä»¥åŠç¬¬ä¸€å¼ å›¾ç‰‡çš„å®Œæ•´åœ°å€:&quot; all url</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥å›¾ç‰‡æ•°é‡:&quot;</span> all</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥ç¬¬ä¸€å¼ å›¾ç‰‡çš„å®Œæ•´åœ°å€:&quot;</span> url</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç† $urlï¼Œ$id å’Œ $prefix çš„è·å–æ¯”è¾ƒç”Ÿç¡¬</span></span><br><span class="line">id=$(<span class="built_in">echo</span> <span class="variable">$url</span> | cut -c56-63)</span><br><span class="line">prefix=$(<span class="built_in">echo</span> <span class="variable">$url</span> | cut -c56-65)</span><br><span class="line">suffix=$(<span class="built_in">echo</span> <span class="variable">$url</span> | cut -f4 -d<span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸»ç›®å½•ä¸‹åˆ›å»ºç›®å½•ï¼Œåç§°æ˜¯æ¼«ç”» id </span></span><br><span class="line"><span class="built_in">cd</span> &amp;&amp; mkdir <span class="string">&quot;<span class="variable">$id</span>&quot;</span> &amp;&amp; <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$id</span>&quot;</span> || <span class="built_in">exit</span> 1</span><br><span class="line"><span class="comment"># å†™å…¥ä¸‹è½½åœ°å€</span></span><br><span class="line">list=url.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$url</span> | sed <span class="string">&#x27;s/master/original/1;s/_master1200//&#x27;</span> &gt; <span class="variable">$list</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="variable">$list</span>) ; <span class="keyword">do</span> seq 1 <span class="variable">$all</span> | xargs -i -- <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span>&quot;</span> &gt; <span class="variable">$list</span>; <span class="keyword">done</span></span><br><span class="line">perl -pi -e <span class="string">&#x27;s/(p)(0)(.)/sprintf(&quot;%s%d%s&quot;,$1,$kv&#123;&quot;$1$2$3&quot;&#125;++,$3)/ge&#x27;</span> <span class="variable">$list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ axel ä¾æ¬¡ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Info&#125;</span> å¼€å§‹ä¸‹è½½æ–‡ä»¶.&quot;</span></span><br><span class="line">cat <span class="variable">$list</span> | xargs -l1 axel -ackv -n 13 -H <span class="string">&quot;Referer: https://www.pixiv.net/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»»åŠ¡ç»“æŸ</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Info&#125;</span> æ–‡ä»¶ä¸‹è½½å®Œæ¯•.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Info&#125;</span> é‡å‘½åå¹¶æ£€æŸ¥æ–‡ä»¶æ•°é‡.&quot;</span></span><br><span class="line">ls *<span class="string">&quot;<span class="variable">$suffix</span>&quot;</span> | awk -F <span class="string">&quot;<span class="variable">$prefix</span>&quot;</span> <span class="string">&#x27;&#123;print &quot;mv &quot;$0&quot; &quot;$1$2&quot;&quot;&#125;&#x27;</span> | <span class="variable">$SHELL</span></span><br><span class="line">result=$(ls *<span class="string">&quot;<span class="variable">$suffix</span>&quot;</span> | wc -l)</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$result</span>&quot;</span> = <span class="string">&quot;<span class="variable">$all</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Info&#125;</span> ä»»åŠ¡å®Œæˆ.&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;Warning&#125;</span> è¯· è¿›å…¥ &quot;</span><span class="variable">$id</span><span class="string">&quot; ç›®å½•æŸ¥çœ‹æƒ…å†µ.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><blockquote>
<p>è„šæœ¬å·²å‘å¸ƒè‡³æˆ‘çš„ <a href="https://gist.github.com/1v9/3be9dd61a30d08b6f47199490dd03afc">Gist</a>ï¼Œä½ å¯ä»¥è‡ªè¡Œæµ‹è¯•ä½¿ç”¨æˆ–è€…ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…åˆ°ä½ çš„ç³»ç»Ÿã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://gist.githubusercontent.com/1v9/3be9dd61a30d08b6f47199490dd03afc/raw/2b3080283463db940ddef2f38c25c0769fa89167/pixiv.sh</span><br><span class="line">mv pixiv.sh /usr/<span class="built_in">local</span>/bin/pixiv</span><br><span class="line">chmod a+x /usr/<span class="built_in">local</span>/bin/pixiv</span><br><span class="line"><span class="built_in">which</span> pixiv</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€ä½ çš„æœ¬åœ°æˆ–è¿œç¨‹ç»ˆç«¯è¿è¡Œ pixiv å‘½ä»¤ï¼Œæˆ‘å»ºè®®ä½¿ç”¨å›½å¤–çš„ vps ä¸‹è½½ï¼Œå›½å†…ä½¿ç”¨è„šæœ¬ä¸‹è½½åŸºæœ¬ä¸Šå¡æ­»ä¸åŠ¨ï¼Œæˆ–è€…ä½ å¾ˆç†Ÿæ‚‰å¦‚ä½•åœ¨å‘½ä»¤è¡Œå†…ä½¿ç”¨ä»£ç†ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ <a href="https://gist.github.com/1v9/3be9dd61a30d08b6f47199490dd03afc#file-pixiv-sh-L28">æ­¤å¤„</a>ã€‚</p>
<h1 id="å±•ç¤º"><a href="#å±•ç¤º" class="headerlink" title="å±•ç¤º"></a>å±•ç¤º</h1><p>ä¸ºäº†å’Œè°ç›´æ¥æ”¾å½•å±ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/1v9/cdn@0.0.1/img/pixiv.webp" loading="lazy"></p>
]]></content>
      <categories>
        <category>Bash</category>
      </categories>
      <tags>
        <tag>Bash</tag>
        <tag>Pixiv</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows Terminal è®¾ç½®</title>
    <url>/post/windows-terminal-settings.html</url>
    <content><![CDATA[<p><a href="https://github.com/microsoft/terminal">Windows Terminal</a> å¯ä»¥ä» <a href="https://www.microsoft.com/store/apps/9n0dx20hk701">Microsoft Store</a> ä¸‹è½½å®‰è£…ã€‚<a id="more"></a></p>
<h1 id="è®¿é—®è®¾ç½®"><a href="#è®¿é—®è®¾ç½®" class="headerlink" title="è®¿é—®è®¾ç½®"></a>è®¿é—®è®¾ç½®</h1><blockquote>
<p>æˆªè‡³ç›®å‰ï¼ˆ2019/8/6ï¼‰ç»ˆç«¯æ‰€æœ‰çš„é€‰é¡¹éƒ½é€šè¿‡æ‰“å¼€ä¸€ä¸ªåä¸º profiles.json çš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚</p>
</blockquote>
<p>ä¸€ç•ªç ”ç©¶åå‘ç°æœ‰ä¸¤å¥—è·¯å¾„ã€‚</p>
<ul>
<li>ä»¥æ­£å¸¸æ–¹å¼æ‰“å¼€çš„ç»ˆç«¯å¯æ‰§è¡Œç¨‹åºå¯¹åº”æ­¤é…ç½®æ–‡ä»¶ï¼š</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">C:\Users\mkb\AppData\Local\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\RoamingState\profiles.json</span></span><br></pre></td></tr></table></figure>

<ul>
<li>éœ€è¦ä¿®æ”¹ç”¨æˆ·æƒé™æ‰å¯ä»¥è®¿é—®çš„ç»ˆç«¯å¯æ‰§è¡Œç¨‹åºåŠå…¶é…ç½®æ–‡ä»¶è·¯å¾„å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">C:\Users\mkb\AppData\Roaming\Microsoft\Windows</span> <span class="string">Terminal\profiles.json</span></span><br><span class="line"><span class="string">C:\Program</span> <span class="string">Files\WindowsApps\Microsoft.WindowsTerminal_0.3.2142.0_x64__8wekyb3d8bbwe\WindowsTerminal.exe</span></span><br></pre></td></tr></table></figure>

<h1 id="ä¿®æ”¹å­—ä½“"><a href="#ä¿®æ”¹å­—ä½“" class="headerlink" title="ä¿®æ”¹å­—ä½“"></a>ä¿®æ”¹å­—ä½“</h1><p>å¯¹äºæˆ‘æ¥è¯´ç»ˆç«¯æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šç”¨é€”ï¼Œå”¯ä¸€éœ€è¦ä¿®æ”¹çš„åœ°æ–¹å°±æ˜¯å­—ä½“ï¼Œé»˜è®¤å­—ä½“ä¸‹è®¿é—®æˆ‘çš„ Debian VPS åè¿‡äºè¾£çœ¼ç›ã€‚æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œæœç´¢ <code>fontFace</code>ï¼Œä¸å‡ºæ„å¤–ä½ åº”è¯¥å¯ä»¥æ‰¾åˆ°ä¸¤ä¸ªä»¥ä¸Šçš„ç»“æœã€‚ä»¥æˆ‘ä¸ªäººä¸ºä¾‹ï¼Œæœ‰ä¸‰å¤„ <code>fontFace</code> åˆ†åˆ«æ§åˆ¶ç€ <code>powershell.exe</code>ã€<code>cmd.exe</code> ä»¥åŠ <code>wsl.exe -d Debian</code> çš„å­—ä½“é€‰é¡¹ã€‚æˆ‘çš„ä¸»åŠ›æ˜¯ PowerShellï¼Œæ‰€ä»¥ä»…ä»…ä¿®æ”¹äº†å®ƒçš„å­—ä½“ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;profiles&quot;</span> <span class="string">:</span> </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="string">&quot;commandline&quot;</span> <span class="string">:</span> <span class="string">&quot;powershell.exe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fontFace&quot;</span> <span class="string">:</span> <span class="string">&quot;DejaVu Sans Mono for Powerline&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fontSize&quot;</span> <span class="string">:</span> <span class="number">10</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="string">&quot;commandline&quot;</span> <span class="string">:</span> <span class="string">&quot;cmd.exe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fontFace&quot;</span> <span class="string">:</span> <span class="string">&quot;Consolas&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fontSize&quot;</span> <span class="string">:</span> <span class="number">10</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="string">&quot;commandline&quot;</span> <span class="string">:</span> <span class="string">&quot;wsl.exe -d Debian&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fontFace&quot;</span> <span class="string">:</span> <span class="string">&quot;Consolas&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fontSize&quot;</span> <span class="string">:</span> <span class="number">10</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>ç›®å‰ Windows 10 å®‰è£…å­—ä½“å¾ˆæ–¹ä¾¿ï¼Œå®‰è£…æ–¹å¼å¤šæ ·ã€‚æˆ‘åœ¨ VPS ä¸­ä½¿ç”¨äº† <a href="https://github.com/powerline/fonts">Powerline fonts</a>ï¼Œä¸ºäº†åœ¨æœ¬åœ°çš„ Windows 10 è·å–åŒæ ·è‰¯å¥½çš„å­—ä½“æ•ˆæœï¼ŒåŒæ ·éœ€è¦å®‰è£… Powerline fontsï¼ŒåŒºåˆ«ä»…ä»…æ˜¯å…‹éš†ä»“åº“åè¿è¡Œ <code>install.ps1</code> è€Œä¸æ˜¯ Linux ä¸‹è¿è¡Œçš„ <code>install.sh</code>ã€‚</p>
<p>ç®€å•åœ°è¯´ï¼Œæ‰¾åˆ°ä½ è¦ä¿®æ”¹çš„å­—ä½“ï¼Œç¡®ä¿å®ƒå¯ç”¨ï¼Œä¿®æ”¹å³å¯ã€‚</p>
<h1 id="å…¶ä»–é€‰é¡¹"><a href="#å…¶ä»–é€‰é¡¹" class="headerlink" title="å…¶ä»–é€‰é¡¹"></a>å…¶ä»–é€‰é¡¹</h1><p>å¾®è½¯æ—¥ååº”è¯¥ä¼šæä¾› GUI æ§åˆ¶é€‰é¡¹ï¼Œå¦å¤–é…ç½®æ–‡ä»¶æ¸…æ™°æ˜äº†ï¼Œæ‰€ä»¥å„ä½å¯ä»¥è‡ªè¡ŒæŠ˜è…¾ã€‚</p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>acme.sh ä¸ Letsencrypt</title>
    <url>/post/acme.sh-and-letsencrypt.html</url>
    <content><![CDATA[<p><a href="https://github.com/Neilpang/acme.sh">acme.sh</a> å®ç°äº† acme åè®®, å¯ä»¥ä» letsencrypt ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚<br>æˆ‘å°†åˆ†äº«æˆ‘ä¸ªäººä½¿ç”¨ acme.sh çš„ DNS API æ¨¡å¼ç”Ÿæˆé€šé…ç¬¦è¯ä¹¦å¹¶å®‰è£…è‡³ Nginx çš„å…¨è¿‡ç¨‹ã€‚<a id="more"></a></p>
<h1 id="å®‰è£…-acme-sh"><a href="#å®‰è£…-acme-sh" class="headerlink" title="å®‰è£… acme.sh"></a>å®‰è£… acme.sh</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>

<p>å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨è®¾ç½® alias æ–¹ä¾¿ä½¿ç”¨ã€‚<br>zsh ç”¨æˆ·ä¹Ÿè®¸å¯èƒ½å¤§æ¦‚éœ€è¦æ‰‹åŠ¨è®¾ç½® aliasã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥ç¼–è¾‘ ~/.zshrcï¼Œæˆ–è€…å…¶ä»–æ–¹æ³•</span></span><br><span class="line"><span class="built_in">alias</span> acme.sh=<span class="string">&#x27;~/.acme.sh/acme.sh&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="ç”Ÿæˆ-letsencrypt-è¯ä¹¦"><a href="#ç”Ÿæˆ-letsencrypt-è¯ä¹¦" class="headerlink" title="ç”Ÿæˆ letsencrypt è¯ä¹¦"></a>ç”Ÿæˆ letsencrypt è¯ä¹¦</h1><p>å¼ºçƒˆå»ºè®®ä½¿ç”¨ <a href="https://github.com/Neilpang/acme.sh/tree/master/dnsapi">DNS API</a> æ¨¡å¼ï¼Œæ”¯æŒåˆ—è¡¨è¯¦è§ <a href="https://github.com/Neilpang/acme.sh#8-automatic-dns-api-integration">æ­¤å¤„</a>ã€‚<br>æˆ‘ä½¿ç”¨çš„æ˜¯ cloudflare çš„ DNS æœåŠ¡ï¼Œå…¶ä»– DNS æä¾›å•†æ˜¯å¦æ”¯æŒä»¥åŠæ“ä½œæ–¹å¼è‡ªè¡Œå‚è€ƒä¸Šé¢çš„ä¸¤ä¸ªé“¾æ¥ï¼ŒåŸºæœ¬ä¸Šä¸»æµ DNS å…¨éƒ¨æ”¯æŒ APIã€‚<br>ä¸æ”¯æŒçš„è¯è€ƒè™‘æ›´æ¢ DNS å§ï¼Œcloudflare å°±æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<h2 id="è·å–-API-Key"><a href="#è·å–-API-Key" class="headerlink" title="è·å– API Key"></a>è·å– API Key</h2><ul>
<li>è®¿é—® <a href="https://dash.cloudflare.com/profile">cloudflare é¢æ¿</a>ã€‚</li>
<li>ç‚¹å‡» API Keys é€‰é¡¹å¡å†… Global API Key é€‰é¡¹çš„ View æŒ‰é’®å–å¾— API keyã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> CF_Key=<span class="string">&quot;ä½ çš„ cloudflare Global API Key&quot;</span></span><br><span class="line"><span class="built_in">export</span> CF_Email=<span class="string">&quot;ä½ çš„ cloudflare æ³¨å†Œé‚®ç®±&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ¶ä½œè¯ä¹¦"><a href="#åˆ¶ä½œè¯ä¹¦" class="headerlink" title="åˆ¶ä½œè¯ä¹¦"></a>åˆ¶ä½œè¯ä¹¦</h2><p>æˆ‘è¿™é‡Œé€‰æ‹©äº† 384 ä½ é€šé…ç¬¦ ECC è¯ä¹¦å¹¶å¼€å¯ OCSP Must-Stapleã€‚ä¹Ÿå¯ä»¥é€‰æ‹© 256 ä½å³ä½¿ç”¨ ec-256 å‚æ•°ï¼Œæ›´å¤šå‚æ•°è¯´æ˜ç‚¹å‡» <a href="https://github.com/Neilpang/acme.sh#san-multi-domain-ecc-certificate">è¿™é‡Œ</a> åŠ <a href="https://github.com/Neilpang/acme.sh/wiki/Options-and-Params">Options and Params</a> æŸ¥çœ‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">acme.sh --issue --dns dns_cf -d your.domain -d <span class="string">&#x27;*.your.domain&#x27;</span> -k ec-384 --ocsp</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…è¯ä¹¦åˆ°-Nginx"><a href="#å®‰è£…è¯ä¹¦åˆ°-Nginx" class="headerlink" title="å®‰è£…è¯ä¹¦åˆ° Nginx"></a>å®‰è£…è¯ä¹¦åˆ° Nginx</h1><blockquote>
<p>è¿™ä¸€æ­¥å¹¶ä¸æ˜¯å¿…é¡»ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å¤åˆ¶æˆ–è€…ç›´æ¥å¼•ç”¨åŸå§‹è¯ä¹¦åœ°å€ï¼Œç¡®ä¿å®‰å…¨å³å¯ã€‚</p>
</blockquote>
<p>acme.sh å†…ç½® â€“installcert å‘½ä»¤ï¼Œä½¿ç”¨è¯´æ˜ <a href="https://github.com/Neilpang/acme.sh#3-install-the-cert-to-apachenginx-etc">åœ¨æ­¤</a>ã€‚è¿™é‡Œå‡è®¾ä½ çš„ Nginx ssl é…ç½®è¯ä¹¦çš„è·¯å¾„ä¸º /path/to/eccï¼Œé‚£ä¹ˆå‘½ä»¤å¦‚ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /path/to/ecc</span><br><span class="line"><span class="comment"># --ecc ECC è¯ä¹¦éœ€è¦æ·»åŠ æ­¤å‚æ•°ï¼ŒRSA è¯ä¹¦è¯·å¿½ç•¥ï¼Œä¸¤è€…è·¯å¾„å¹¶ä¸ç›¸åŒã€‚</span></span><br><span class="line"><span class="comment"># --reloadcmd ä¸º Nginx é‡å¯æˆ–é‡è½½å‘½ä»¤ï¼Œè¯·ä¾æ®ä½ è‡ªå·±çš„è®¾ç½®ã€‚</span></span><br><span class="line">acme.sh --installcert --ecc -d your.domain \</span><br><span class="line">--key-file /path/to/ecc/your.doamin.key \</span><br><span class="line">--fullchain-file /path/to/ecc/fullchain.cer \</span><br><span class="line">--reloadcmd <span class="string">&quot;service nginx restart&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="è¯ä¹¦ç­¾å‘çš„é™åˆ¶"><a href="#è¯ä¹¦ç­¾å‘çš„é™åˆ¶" class="headerlink" title="è¯ä¹¦ç­¾å‘çš„é™åˆ¶"></a>è¯ä¹¦ç­¾å‘çš„é™åˆ¶</h1><p>ä¸è¦åœ¨çŸ­æ—¶é—´å†…é«˜é¢‘ç‡åœ°ç­¾å‘è¯ä¹¦ï¼Œletsencrypt æ˜¯æœ‰ç€ä¸¥æ ¼é™åˆ¶çš„ã€‚<br>æ„Ÿå…´è¶£å¯ä»¥è®¿é—® <a href="https://letsencrypt.org/docs/rate-limits/">å®˜æ–¹å£°æ˜</a>äº†è§£è¯¦æƒ…ã€‚</p>
]]></content>
      <categories>
        <category>HTTPS</category>
      </categories>
      <tags>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Gulp ç²¾ç®€ Hexo</title>
    <url>/post/use-gulp-to-minify-hexo.html</url>
    <content><![CDATA[<div class="note danger"><p>ç²¾ç®€å¯èƒ½å¯¼è‡´æœ¬åœ°é¢„è§ˆä¸æœ€ç»ˆå‘å¸ƒçš„ç‰ˆæœ¬æœ‰æ‰€å·®å¼‚ç”šè‡³äº§ç”Ÿ BUGï¼Œæ‰€ä»¥å¼€å¯ä¸ªåˆ«é€‰é¡¹éœ€è¦æ…é‡ã€‚</p>
</div>

<blockquote>
<p>ä¸ºäº†æ›´å¥½åœ°åº”å¯¹ ES6 è¯­æ³•ï¼Œæœ¬åšå®¢å·²å¼ƒç”¨ Babel ä¸ Uglifyã€‚</p>
</blockquote>
<p><a href="https://gulpjs.com/">gulp</a> æ˜¯åŸºäºæµçš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œä½¿ç”¨ gulp ä»¥åŠ gulp æ’ä»¶æˆ‘ä»¬å¯ä»¥è¾¾æˆå¾ˆå¤šç›®çš„ï¼Œæ¯”å¦‚ç²¾ç®€ Hexo é¡¹ç›®ã€‚<a id="more"></a></p>
<h1 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h1><h2 id="gulp-æœ¬ä½“"><a href="#gulp-æœ¬ä½“" class="headerlink" title="gulp æœ¬ä½“"></a>gulp æœ¬ä½“</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€å®‰è£…</span></span><br><span class="line">npm i gulp -g</span><br></pre></td></tr></table></figure>

<h2 id="gulp-æ’ä»¶"><a href="#gulp-æ’ä»¶" class="headerlink" title="gulp æ’ä»¶"></a>gulp æ’ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ Hexo ç›®å½•å†…è¿è¡Œå‘½ä»¤å®‰è£…</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ --save-devï¼Œä¸ Hexo å½“å‰çš„ä¾èµ–åŒºåˆ†å¼€æ¥</span></span><br><span class="line">npm i --save-dev \</span><br><span class="line">gulp-terser \</span><br><span class="line">gulp-htmlmin \</span><br><span class="line">gulp-imagemin \</span><br><span class="line">gulp-clean-css \</span><br><span class="line">gulp-minify-inline</span><br></pre></td></tr></table></figure>

<h1 id="æ­å»ºä»»åŠ¡"><a href="#æ­å»ºä»»åŠ¡" class="headerlink" title="æ­å»ºä»»åŠ¡"></a>æ­å»ºä»»åŠ¡</h1><blockquote>
<p>gulp ä»»åŠ¡æµç¨‹é€šè¿‡ <a href="https://gulpjs.com/docs/en/getting-started/javascript-and-gulpfiles#gulpfile-explained">gulpfile.js</a> æ–‡ä»¶æ§åˆ¶ã€‚</p>
</blockquote>
<p>é¦–å…ˆåœ¨ Hexo é¡¹ç›®å†…åˆ›å»º gulpfile.js æ–‡ä»¶ï¼Œ<mark>ä»…ä¾›å‚è€ƒ</mark>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">const gulp = require(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line">const terser = require(<span class="string">&#x27;gulp-terser&#x27;</span>);</span><br><span class="line">const htmlmin = require(<span class="string">&#x27;gulp-htmlmin&#x27;</span>);</span><br><span class="line">const imagemin = require(<span class="string">&#x27;gulp-imagemin&#x27;</span>);</span><br><span class="line">const cleanCSS = require(<span class="string">&#x27;gulp-clean-css&#x27;</span>);</span><br><span class="line">const minifyInline = require(<span class="string">&#x27;gulp-minify-inline&#x27;</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">&#x27;minify-html&#x27;</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> gulp.src(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">  .pipe(htmlmin(&#123;</span><br><span class="line">    minifyURLs: <span class="literal">true</span>, // Minify URLs <span class="keyword">in</span> various attributes (uses relateurl)</span><br><span class="line">    useShortDoctype: <span class="literal">true</span>, // Replaces the doctype with the short (HTML5) doctype</span><br><span class="line">    collapseWhitespace: <span class="literal">true</span>, // Collapse white space that contributes to text nodes <span class="keyword">in</span> a document tree</span><br><span class="line">    conservativeCollapse: <span class="literal">true</span>, // Always collapse to 1 space (never remove it entirely). Must be used <span class="keyword">in</span> conjunction with collapseWhitespace=<span class="literal">true</span></span><br><span class="line">    collapseInlineTagWhitespace: <span class="literal">true</span>, // Don<span class="string">&#x27;t leave any spaces between display:inline; elements when collapsing. Must be used in conjunction with collapseWhitespace=true</span></span><br><span class="line"><span class="string">    collapseBooleanAttributes: true, // Omit attribute values from boolean attributes</span></span><br><span class="line"><span class="string">    removeComments: true, // Strip HTML comments</span></span><br><span class="line"><span class="string">    removeEmptyAttributes: true, // Remove all attributes with whitespace-only values</span></span><br><span class="line"><span class="string">    removeScriptTypeAttributes: true, // Remove type=&quot;text/javascript&quot; from script tags. Other type attribute values are left intact</span></span><br><span class="line"><span class="string">    removeStyleLinkTypeAttributes: true // Remove type=&quot;text/css&quot; from style and link tags. Other type attribute values are left intact</span></span><br><span class="line"><span class="string">  &#125;))</span></span><br><span class="line"><span class="string">  .pipe(minifyInline())</span></span><br><span class="line"><span class="string">  .pipe(gulp.dest(&#x27;</span>./public<span class="string">&#x27;));</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gulp.task(&#x27;</span>minify-css<span class="string">&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="string">  return gulp.src(&#x27;</span>./public/**/*.css<span class="string">&#x27;, &#x27;</span>!./public/**/*.min.css<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">  .pipe(cleanCSS(&#123;debug: true&#125;, details =&gt; &#123;</span></span><br><span class="line"><span class="string">    console.log(`$&#123;details.name&#125;: $&#123;details.stats.originalSize&#125;`);</span></span><br><span class="line"><span class="string">    console.log(`$&#123;details.name&#125;: $&#123;details.stats.minifiedSize&#125;`);</span></span><br><span class="line"><span class="string">  &#125;))</span></span><br><span class="line"><span class="string">  .pipe(gulp.dest(&#x27;</span>./public<span class="string">&#x27;));</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gulp.task(&#x27;</span>minify-js<span class="string">&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="string">  return gulp.src([</span></span><br><span class="line"><span class="string">    &#x27;</span>./public/**/*.js<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>!./public/**/*.min.js<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>!./public/**/*.umd.js<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  ])</span></span><br><span class="line"><span class="string">  .pipe(terser(&#123;</span></span><br><span class="line"><span class="string">    keep_fnames: true,</span></span><br><span class="line"><span class="string">    mangle: false</span></span><br><span class="line"><span class="string">  &#125;))</span></span><br><span class="line"><span class="string">  .pipe(gulp.dest(&#x27;</span>./public<span class="string">&#x27;));</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gulp.task(&#x27;</span>minify-img<span class="string">&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="string">  return gulp.src(&#x27;</span>./public/image/**/*.*<span class="string">&#x27;, &#x27;</span>./public/image/**/*.webp<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">  .pipe(imagemin([</span></span><br><span class="line"><span class="string">    imagemin.gifsicle(&#123;interlaced: true&#125;),</span></span><br><span class="line"><span class="string">    imagemin.jpegtran(&#123;progressive: true&#125;),</span></span><br><span class="line"><span class="string">    imagemin.optipng(&#123;optimizationLevel: 7&#125;),</span></span><br><span class="line"><span class="string">    imagemin.svgo(&#123;</span></span><br><span class="line"><span class="string">      plugins: [</span></span><br><span class="line"><span class="string">        &#123;removeViewBox: true&#125;,</span></span><br><span class="line"><span class="string">        &#123;cleanupIDs: false&#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  ]))</span></span><br><span class="line"><span class="string">  .pipe(gulp.dest(&#x27;</span>./public/image<span class="string">&#x27;))</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">gulp.task(</span></span><br><span class="line"><span class="string">  &#x27;</span>default<span class="string">&#x27;, </span></span><br><span class="line"><span class="string">  gulp.series(</span></span><br><span class="line"><span class="string">    &#x27;</span>minify-html<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>minify-css<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>minify-js<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#x27;</span>minify-img<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">);</span></span><br></pre></td></tr></table></figure>

<h1 id="è¿è¡Œä»»åŠ¡"><a href="#è¿è¡Œä»»åŠ¡" class="headerlink" title="è¿è¡Œä»»åŠ¡"></a>è¿è¡Œä»»åŠ¡</h1><p>ä¹‹å‰å…¨å±€å®‰è£…äº† Gulpï¼Œåœ¨ Hexo é¡¹ç›®å†…æ‰§è¡Œå‘½ä»¤è¿˜éœ€è¦è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm link gulp</span><br></pre></td></tr></table></figure>

<p>Gulp ç²¾ç®€çš„å†…å®¹æ˜¯ public ç›®å½•ä¸‹çš„å†…å®¹ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g</span><br></pre></td></tr></table></figure>

<p>æœ€åè¿è¡Œ Gulp ä»»åŠ¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gulp</span><br></pre></td></tr></table></figure>

<h1 id="ä»»åŠ¡ç»“æœ"><a href="#ä»»åŠ¡ç»“æœ" class="headerlink" title="ä»»åŠ¡ç»“æœ"></a>ä»»åŠ¡ç»“æœ</h1><p>ç”©å¼ å›¾å§ï¼Œä»»åŠ¡æˆåŠŸè¿è¡Œå¤§æ¦‚å°±æ˜¯è¿™æ ·å­ï¼Œå…·ä½“ç»“æœè‡ªè¡Œæ¯”å¯¹å³å¯ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/1v9/cdn@0.0.1/img/gulp.webp" loading="lazy"></p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://github.com/duan602728596/gulp-terser">gulp-terser</a></li>
<li><a href="https://github.com/jonschlinkert/gulp-htmlmin">gulp-htmlmin</a></li>
<li><a href="https://github.com/sindresorhus/gulp-imagemin">gulp-imagemin</a></li>
<li><a href="https://github.com/scniro/gulp-clean-css">gulp-clean-css</a></li>
<li><a href="https://github.com/shkuznetsov/gulp-minify-inline">gulp-minify-inline</a></li>
</ul>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Gulp</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤‡ä»½æ–‡ä»¶è‡³ Github ç§æœ‰ä»“åº“</title>
    <url>/post/backup-files-to-github-private-repo.html</url>
    <content><![CDATA[<p><a href="https://github.blog/2019-01-07-new-year-new-github/">å–œå¤§æ™®å¥”</a>ï¼ŒGitHub Free å¯ä»¥ä½¿ç”¨æ— é™çš„ç§æœ‰ä»“åº“ã€‚<br>æœ¬æ–‡å°†ä»‹ç»é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºè¿œç¨‹ç§æœ‰ä»“åº“å¹¶å°†æœ¬åœ°æ–‡ä»¶æ¨é€è‡³è¿œç¨‹ä»“åº“çš„è¿‡ç¨‹ã€‚<a id="more"></a></p>
<h1 id="SSH-key"><a href="#SSH-key" class="headerlink" title="SSH key"></a>SSH key</h1><h2 id="ç”Ÿæˆå¯†é’¥"><a href="#ç”Ÿæˆå¯†é’¥" class="headerlink" title="ç”Ÿæˆå¯†é’¥"></a>ç”Ÿæˆå¯†é’¥</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">EMAIL=å¡«å…¥ä½ çš„ Github é‚®ç®±</span><br><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;<span class="variable">$EMAIL</span>&quot;</span></span><br><span class="line"><span class="comment"># å£ä»¤æ˜¯å¦è®¾ç½®è¯·è‡ªè¡Œé€‰æ‹©ï¼Œæˆ‘ä¸€è·¯å›è½¦å…¨éƒ¨ç•™ç©ºäº†</span></span><br><span class="line"><span class="comment"># é»˜è®¤ç”Ÿæˆ ~/.ssh/id_ed25519.pub</span></span><br></pre></td></tr></table></figure>

<h2 id="æ·»åŠ åˆ°-Github"><a href="#æ·»åŠ åˆ°-Github" class="headerlink" title="æ·»åŠ åˆ° Github"></a>æ·»åŠ åˆ° Github</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_ed25519.pub</span><br><span class="line"><span class="comment"># å¤åˆ¶å†…å®¹ä¸‹ä¸€æ­¥å¤‡ç”¨</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ­¤å¤„ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ“ä½œï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œç ”ç©¶ Github API æ–‡æ¡£ï¼Œç½‘é¡µæ“ä½œçš„è¯æ›´åŠ ç›´è§‚ä¸€ç‚¹ã€‚</p>
</blockquote>
<p>è®¿é—® <a href="https://github.com/settings/keys">SSH and GPG keys</a>ï¼Œç‚¹å‡» New SSH keyï¼Œé»è´´ä¸Šä¸€æ­¥å¤åˆ¶çš„å†…å®¹ï¼Œæ ‡é¢˜å¯ä»¥çœç•¥ã€‚</p>
<h2 id="éªŒè¯å¯†é’¥"><a href="#éªŒè¯å¯†é’¥" class="headerlink" title="éªŒè¯å¯†é’¥"></a>éªŒè¯å¯†é’¥</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span> $(ssh-agent -s)</span><br><span class="line">ssh-add ~/.ssh/id_ed25519</span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<h1 id="Access-token"><a href="#Access-token" class="headerlink" title="Access token"></a>Access token</h1><p>è®¿é—® <a href="https://github.com/settings/tokens">Personal Access Tokens</a> ç‚¹å‡» Generate new token æŒ‰é’®ã€‚<br>æˆäºˆ repo æ“ä½œç›¸å…³æƒé™ï¼ŒåŠ¡å¿…æ‰‹åŠ¨ä¸”å®‰å…¨åœ°ä¿å­˜ tokenï¼Œå› ä¸ºåªæ˜¾ç¤ºä¸€æ¬¡ã€‚<br>è½»åº¦ç”¨æˆ·å®Œå…¨å¯ä»¥ç”¨ä¸€æ¬¡ token åˆ ä¸€æ¬¡ï¼Œè¿™æ ·ä¹Ÿæ›´åŠ å®‰å…¨ã€‚</p>
<h1 id="åˆ›å»ºè¿œç¨‹ç§æœ‰ä»“åº“"><a href="#åˆ›å»ºè¿œç¨‹ç§æœ‰ä»“åº“" class="headerlink" title="åˆ›å»ºè¿œç¨‹ç§æœ‰ä»“åº“"></a>åˆ›å»ºè¿œç¨‹ç§æœ‰ä»“åº“</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">user_name=å¡«å…¥ä½ çš„ Github ç”¨æˆ·å</span><br><span class="line">repo_name=å¡«å…¥ä½ æ–°å»ºçš„ä»“åº“åï¼Œç¡®ä¿ä¸è¦é‡å¤</span><br><span class="line">github_token=å¡«å…¥ä½ çš„ access token</span><br><span class="line">curl -u <span class="string">&quot;<span class="variable">$user_name</span>:<span class="variable">$github_token</span>&quot;</span> https://api.github.com/user/repos -d <span class="string">&#x27;&#123;&quot;name&quot;:&quot;&#x27;</span><span class="variable">$repo_name</span><span class="string">&#x27;&quot;,&quot;private&quot;:true&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="åˆå§‹åŒ–å¹¶æ¨é€æœ¬åœ°ä»“åº“"><a href="#åˆå§‹åŒ–å¹¶æ¨é€æœ¬åœ°ä»“åº“" class="headerlink" title="åˆå§‹åŒ–å¹¶æ¨é€æœ¬åœ°ä»“åº“"></a>åˆå§‹åŒ–å¹¶æ¨é€æœ¬åœ°ä»“åº“</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">BACKUP=å¡«å…¥ä½ æƒ³è¦å¤‡ä»½çš„ç›®å½•çš„ç»å¯¹è·¯å¾„</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$BACKUP</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# <span class="variable">$repo_name</span>&quot;</span> &gt;&gt; README.md</span><br><span class="line"><span class="comment"># æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œæ¯”å¦‚å¤§æ–‡ä»¶ã€æœ‰é£é™©çš„æ–‡ä»¶</span></span><br><span class="line">vi .gitignore</span><br><span class="line">git init</span><br><span class="line">git add -A</span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘è®¾ç½®æäº¤è®°å½•ä¸ºæ—¥æœŸå½¢å¼ï¼Œæ¯•ç«Ÿç›®çš„æ˜¯å¤‡ä»½</span></span><br><span class="line">git commit -m <span class="string">&quot;`date --rfc-3339=seconds`&quot;</span></span><br><span class="line">git remote add origin git@github.com:<span class="variable">$user_name</span>/<span class="variable">$repo_name</span>.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h1 id="å…³äºå®‰å…¨æ€§"><a href="#å…³äºå®‰å…¨æ€§" class="headerlink" title="å…³äºå®‰å…¨æ€§"></a>å…³äºå®‰å…¨æ€§</h1><ul>
<li>ä¸è¦æ¨é€ä»»ä½•å¯èƒ½æ³„éœ²è´¦æˆ·ä¸ä¸ªäººéšç§ç­‰å±é™©ä¿¡æ¯çš„æ–‡ä»¶ã€‚</li>
<li>å¦¥å–„ä¿ç®¡ ssh key ä¸ access tokenï¼Œå¦‚æœé—å¤±æˆ–è€…ä»…ä»…å°é²œï¼Œè¯·è‡ªè¡Œé€šè¿‡ Github ç½‘ç«™å–æ¶ˆå®ƒä»¬çš„æˆæƒã€‚</li>
<li>æ­£å¸¸æ¥è¯´ï¼Œå¯ç”¨ Github è´¦æˆ·ä¸¤æ­¥éªŒè¯ã€å¤šæ³¨æ„é‚®ç®±é€šçŸ¥ã€ä¸è¦åœ¨ä¸ç†Ÿæ‚‰çš„è®¾å¤‡ä¸Šæ“ä½œï¼Œæ²¡æœ‰å¤ªå¤§é—®é¢˜ã€‚</li>
</ul>
<h1 id="å‚è€ƒå†…å®¹"><a href="#å‚è€ƒå†…å®¹" class="headerlink" title="å‚è€ƒå†…å®¹"></a>å‚è€ƒå†…å®¹</h1><ul>
<li><a href="https://curl.haxx.se/docs/manpage.html">curl - How To Use</a></li>
<li><a href="https://developer.github.com/v3/repos/#create">Repositories | GitHub Developer Guide</a></li>
<li><a href="https://help.github.com/cn/articles/connecting-to-github-with-ssh">ä½¿ç”¨ SSH è¿æ¥åˆ° GitHub - Github å¸®åŠ©</a></li>
<li><a href="https://www.ssh.com/ssh/keygen/#sec-Choosing-an-Algorithm-and-Key-Size">How to use ssh-keygen to generate a new SSH key | SSH.COM</a></li>
</ul>
]]></content>
      <categories>
        <category>Github</category>
      </categories>
      <tags>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜»æ­¢é’ˆå¯¹ NGINX çš„æ¶æ„è®¿é—®</title>
    <url>/post/block-malicious-access-to-nginx.html</url>
    <content><![CDATA[<p>ä¸ºäº†å¯¹ä»˜çˆ¬è™«ä»¥åŠå„ç§æ”»å‡»ï¼Œèµ·åˆæˆ‘é€‰æ‹©è‡ªå·±ç¼–å†™ Bash è„šæœ¬å®šæ—¶ç›‘æ§ Nginx æ—¥å¿—ã€‚<br>é—®é¢˜æ˜¯å¯¹ Nginx ä¸ç®¡ä¸é¡¾å¯èƒ½å¯¼è‡´æ¶æ„è®¿é—®åœ¨è¢«å°ç¦ä¹‹å‰å·²ç»å¾—é€ã€‚<br>å¦å¤–å†™æ­£åˆ™å¹¶ä¸æ˜¯ä¸€ä¸ªæ„‰å¿«çš„è¿‡ç¨‹ï¼Œæˆ‘çš„ç›®çš„æ˜¯è¯†åˆ«å‡ºæ¶æ„è®¿é—®ï¼Œç„¶åé˜»æ­¢è¿™äº›è¯·æ±‚å¹¶å°ç¦ IPã€‚<br>ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ‘¸ç´¢ï¼Œå…³é”®è¯å°±æ˜¯ <a href="https://httpstatuses.com/444">444</a> ä»¥åŠ <a href="https://www.fail2ban.org/">Fail2ban</a>ã€‚<a id="more"></a></p>
<h1 id="ç¯å¢ƒéœ€æ±‚"><a href="#ç¯å¢ƒéœ€æ±‚" class="headerlink" title="ç¯å¢ƒéœ€æ±‚"></a>ç¯å¢ƒéœ€æ±‚</h1><ul>
<li><a href="https://nginx.org/">Nginx</a> - éœ€è¦è‡ªå·± <a href="https://1v9.im/post/compiling-and-installing-nginx.html">ç¼–è¯‘</a>ã€‚</li>
<li><a href="https://github.com/nbs-system/naxsi">Naxsi</a> - å¼€æºçš„ Nginx WAFï¼Œä¸ Nginx ä¸€èµ· <a href="https://github.com/nbs-system/naxsi/wiki/naxsi-compile">ç¼–è¯‘</a>ã€‚</li>
<li><a href="https://github.com/leev/ngx_http_geoip2_module">Nginx GeoIP2 module</a> - è¯·è®¤å‡†è¿™æ˜¯ GeoIP2ï¼Œä½¿ Nginx è¯†åˆ« IP æ‰€åœ¨çš„å›½å®¶å’ŒåŸå¸‚ï¼ŒåŒæ ·ä¸ Nginx ä¸€èµ· <a href="https://github.com/leev/ngx_http_geoip2_module#installing">ç¼–è¯‘</a>ã€‚</li>
</ul>
<h1 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h1><h2 id="è¯·æ±‚æ—¥å¿—"><a href="#è¯·æ±‚æ—¥å¿—" class="headerlink" title="è¯·æ±‚æ—¥å¿—"></a><a href="https://nginx.org/en/docs/http/ngx_http_log_module.html#access_log">è¯·æ±‚æ—¥å¿—</a></h2><p>é¦–å…ˆå¯åŠ¨äººçœ¼è§‚å¯Ÿï¼Œä» Nginx çš„ access_log ä¸­æ‘˜å–ä¸€æ¬¡å…¸å‹çš„æ¶æ„è®¿é—®ã€‚</p>
<blockquote>
<p>å› ä¸ºæˆ‘å·²ç»å®Œæˆäº†æœ¬æ–‡çš„å·¥ä½œï¼Œæ‰€ä»¥å®ƒçš„å“åº”æ˜¯ 444ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ 404ã€‚</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="number">118.42</span><span class="string">.xxx.xx</span> <span class="bullet">-</span> <span class="bullet">-</span> [<span class="number">02</span><span class="string">/Feb/2019:08:23:40</span> <span class="string">+0800</span>] <span class="string">&quot;GET /phpMyAdmion/index.php HTTP/1.1&quot;</span> <span class="number">444</span> <span class="number">0</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€è¡Œçš„æ ¼å¼éƒ½æ˜¯è¿™æ ·çš„ï¼ˆæ²¡æœ‰è‡ªå®šä¹‰ <a href="https://nginx.org/en/docs/http/ngx_http_log_module.html#log_format">log_format</a> çš„è¯ï¼‰ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">$remote_addr</span> <span class="bullet">-</span> <span class="bullet">-</span> [<span class="string">$time_local</span>] <span class="string">&quot;$request&quot;</span> <span class="string">$status</span> <span class="string">$body_bytes_sent</span> <span class="string">&quot;$http_referer&quot;</span> <span class="string">&quot;$http_user_agent&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ç»™ $remote_addrã€$requestã€$http_refererã€$http_user_agent åŠ ä¸Šä¸€å±‚åˆ¤å®šå†åšå‡ºè®¾ç½®å¥½çš„å“åº”ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯æ ¹æ®è¿œç¨‹ IPã€è¯·æ±‚ã€è¯·æ±‚æ¥æºã€ç”¨æˆ·ä»£ç†åšå‡ºç›¸åŒï¼ˆä¸€ç½‘æ‰“å°½ï¼‰æˆ–ä¸åŒï¼ˆä¸ªæ€§åŒ–ï¼‰çš„å¤„ç†ã€‚</p>
<p>æˆ‘çš„æ–¹æ¡ˆæ˜¯ä¸€ç½‘æ‰“å°½ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„é…ç½®ï¼Œæœ€ç»ˆè¡¨ç°ä¸º access_log ä¸­çš„æ¶æ„è®¿é—®çš„å“åº”ä¸ºç»Ÿä¸€çš„ 444ï¼Œç„¶åä½¿ç”¨ Fail2ban ç›‘æ§è¯·æ±‚æ—¥å¿—å®ç° IP å°ç¦ã€‚</p>
<h2 id="é”™è¯¯æ—¥å¿—"><a href="#é”™è¯¯æ—¥å¿—" class="headerlink" title="é”™è¯¯æ—¥å¿—"></a><a href="https://nginx.org/en/docs/ngx_core_module.html#error_log">é”™è¯¯æ—¥å¿—</a></h2><p>è¿™é‡ŒçœŸæ­£æ¶‰åŠçš„æ˜¯ <a href="https://github.com/nbs-system/naxsi/wiki/naxsilogs">naxsilogs</a> ä¹Ÿå°±æ˜¯ Naxsi æ—¥å¿—ï¼Œnaxsilogs å†™å…¥è‡³ Nginx çš„ error_logã€‚</p>
<p>æˆ‘å°† Naxsi è§„åˆ™è§¦å‘åçš„å“åº”åŒæ ·è®¾ç½®ä¸º 444ï¼Œæ­¤æ—¶è¿™ä¸€ç±»è¯·æ±‚å¹¶ä¸ä¼šå†™å…¥ Nginx çš„ access_log è€Œåªä¼šå†™å…¥ error_logï¼Œå¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">æ¶æ„è®¿é—®è§¦å‘</span> <span class="string">Naxsi</span> <span class="string">------&gt;</span> <span class="number">444</span> <span class="string">å“åº”</span> <span class="string">------&gt;</span> <span class="string">å†™å…¥</span> <span class="string">error.log</span></span><br></pre></td></tr></table></figure>

<p>å‚è€ƒä¸Šæ–‡ï¼ŒåŒæ ·é…åˆ Fail2ban ä½¿ç”¨ï¼Œåªä¸è¿‡è¿™ä¸€æ¬¡ç›‘æ§çš„æ—¥å¿—å¹¶ä¸ä¸€æ ·ã€‚</p>
<h2 id="æ¨¡å—ä¸æŒ‡ä»¤"><a href="#æ¨¡å—ä¸æŒ‡ä»¤" class="headerlink" title="æ¨¡å—ä¸æŒ‡ä»¤"></a>æ¨¡å—ä¸æŒ‡ä»¤</h2><ul>
<li><a href="https://nginx.org/en/docs/http/ngx_http_map_module.html">map</a> - æ¶‰åŠæœ€å¤šçš„æ¨¡å—ï¼Œå¤§å¤šåˆ¤å®šåŸºäº map æŒ‡ä»¤ã€‚</li>
<li><a href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return">return</a> - é’ˆå¯¹æˆ‘ä»¬æ‰€å®šä¹‰çš„æ¶æ„è®¿é—®è¿”å›è®¾å®šçš„å“åº”ã€‚</li>
<li><a href="https://nginx.org/en/docs/ngx_core_module.html#include">include</a> - ç”¨æ¥åˆ†ç¦»å¹¶å¼•ç”¨å¤šä¸ªé…ç½®ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</li>
</ul>
<h2 id="Fail2ban"><a href="#Fail2ban" class="headerlink" title="Fail2ban"></a>Fail2ban</h2><p>æˆ‘å¯¹ Fail2ban æ²¡ä»€ä¹ˆæ·±å…¥ä½“éªŒä½†ä¸å¦¨ç¢ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šèƒ½é‡åˆ°çš„é—®é¢˜éƒ½å¯ä»¥æœç´¢åˆ°ç­”æ¡ˆã€‚<br>ä¹‹å‰å¯¹ Fail2ban çš„å°è±¡åœç•™åœ¨ SSH é˜²çˆ†ç ´ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä½¿ç”¨ <a href="https://www.sshguard.net/">sshguard</a> ä»¥åå°±æ›´åŠ æ²¡æ¥è§¦è¿‡å®ƒã€‚<br>Fail2ban å¯ä»¥ç›‘æ§å„å¼å„æ ·çš„æ—¥å¿—ï¼Œä¾æ®ä½ è®¾å®šçš„è§„åˆ™æ§åˆ¶ iptables å®ç° IP å°ç¦ã€‚<br>å®‰è£…è¿‡åæ›´æ˜¯æœ‰å¾ˆå¤šé…ç½®å¯ä»¥é€‰ç”¨ï¼Œæ¶µç›– Apacheã€Nginxã€HAProxy ç­‰ç­‰ã€‚<br>å°±æœ¬æ–‡æ¥è¯´ï¼Œæ–°å¢ä¸¤ä¸ª jail ä»¥åŠ filter å°±è¶³å¤Ÿäº†ã€‚</p>
<h1 id="Nginx-è®¾ç½®"><a href="#Nginx-è®¾ç½®" class="headerlink" title="Nginx è®¾ç½®"></a>Nginx è®¾ç½®</h1><h2 id="ä¸»é…ç½®"><a href="#ä¸»é…ç½®" class="headerlink" title="ä¸»é…ç½®"></a>ä¸»é…ç½®</h2><p>nginx.conf</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="string">http</span></span><br><span class="line">	&#123;	</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ¶æ„è¯·æ±‚ä¸€å¾‹è¿”å› 444 çŠ¶æ€ç </span></span><br><span class="line">            <span class="comment"># åç»­é…åˆ Fail2ban å®ç° IP å°ç¦</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç”¨æˆ·ä»£ç†è§„åˆ™ï¼Œé’ˆå¯¹ User-Agent</span></span><br><span class="line">	    <span class="string">include</span> <span class="string">UA.rules;</span></span><br><span class="line">        </span><br><span class="line">            <span class="comment"># å›½åˆ«è§„åˆ™ï¼Œé’ˆå¯¹å›½å®¶</span></span><br><span class="line">	    <span class="string">include</span> <span class="string">GeoIP2.rules;</span></span><br><span class="line">        </span><br><span class="line">            <span class="comment"># é¢å¤–è§„åˆ™ï¼Œä¸¤ä¸ªç®€å•çš„ if åˆ¤æ–­</span></span><br><span class="line">            <span class="string">include</span> <span class="string">extra.rules;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Naxsi æ ¸å¿ƒè§„åˆ™</span></span><br><span class="line">	    <span class="string">include</span> <span class="string">naxsi_core.rules;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># é»˜è®¤ä¸»æœº/ç©ºä¸»æœº</span></span><br><span class="line">            <span class="string">server</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">listen</span> <span class="number">80</span> <span class="string">default_server;</span></span><br><span class="line">                    <span class="string">server_name</span> <span class="string">_;</span></span><br><span class="line">                    <span class="string">return</span> <span class="number">444</span><span class="string">;</span></span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">            <span class="comment"># å¼•å…¥ç«™ç‚¹é…ç½®</span></span><br><span class="line">            <span class="string">include</span> <span class="string">vhost/*.conf;</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æˆ·ä»£ç†è§„åˆ™"><a href="#ç”¨æˆ·ä»£ç†è§„åˆ™" class="headerlink" title="ç”¨æˆ·ä»£ç†è§„åˆ™"></a>ç”¨æˆ·ä»£ç†è§„åˆ™</h2><p>UA.rules</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">map</span> <span class="string">$http_user_agent</span> <span class="string">$UA_Policy</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é»˜è®¤è®¾ä¸º 0ï¼Œå¯ä»¥è®¾ä¸ºä»»æ„å­—ç¬¦</span></span><br><span class="line">    <span class="string">default</span> <span class="number">0</span><span class="string">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ­£åˆ™åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰User-Agent</span></span><br><span class="line">    <span class="comment"># è¿™äº›ä»…ä»…æ˜¯æˆ‘ä¸ªäººåˆ¤å®šçš„æ¶æ„ UAï¼Œä¸å…·æœ‰ä»»ä½•è¯´æœåŠ›</span></span><br><span class="line">    <span class="comment"># å› ä¸ºå®ƒä»¬å¤§å¤šé”²è€Œä¸èˆå®åœ¨çƒ¦äººï¼Œæ¯”å¦‚ masscan å°±æ˜¯ä¸ªçŸ¥åçš„æ‰«æå·¥å…·</span></span><br><span class="line">    <span class="string">~*(?i)(.Net|ipip|masscan|ZeMu|Morfeus|Netcraft|zgrab|Solstice|Python)</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŒ¹é…ç©ºç™½ UA</span></span><br><span class="line">    <span class="string">&quot;&quot;</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å›½åˆ«è§„åˆ™"><a href="#å›½åˆ«è§„åˆ™" class="headerlink" title="å›½åˆ«è§„åˆ™"></a>å›½åˆ«è§„åˆ™</h2><p>GeoIP2.rules | GeoIP2 é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/ISO_3166-2">ISO 3166-2</a> ä»£ç </p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŒ¹é…å›½å®¶ï¼Œè¯·è°ƒæ•´ä¸ºè‡ªå·±æƒ³è¦çš„é…ç½®æˆ–è€…å¹²è„†å¿½ç•¥</span></span><br><span class="line"><span class="string">map</span> <span class="string">$geoip2_data_country_code</span> <span class="string">$Country_Policy</span> &#123;</span><br><span class="line">    <span class="string">default</span> <span class="number">0</span><span class="string">;</span></span><br><span class="line">    <span class="string">BY</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">    <span class="string">RU</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">    <span class="string">KR</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">    <span class="string">IR</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">    <span class="string">SG</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">   <span class="comment">#CN 1;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤å¤„å¾€ä¸‹æ®µè½ä¿®æ”¹è‡ª https://github.com/leev/ngx_http_geoip2_module#example-usage</span></span><br><span class="line"><span class="comment"># è¯·æ³¨æ„ä½ çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™æ˜¯æˆ‘çš„é…ç½®ï¼Œè¿™å‡ æ®µä¹Ÿå¯ä»¥ç›´æ¥å†™è¿› http æ®µè½</span></span><br><span class="line"><span class="string">geoip2</span> <span class="string">conf/GeoLite2-City.mmdb</span> &#123;</span><br><span class="line">    <span class="string">$geoip2_data_city_name</span> <span class="string">default=Shanghai</span> <span class="string">city</span> <span class="string">names</span> <span class="string">zh-CN;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">geoip2</span> <span class="string">conf/GeoLite2-Country.mmdb</span> &#123;</span><br><span class="line">    <span class="string">auto_reload</span> <span class="string">5m;</span></span><br><span class="line">    <span class="string">$geoip2_metadata_country_build</span> <span class="string">metadata</span> <span class="string">build_epoch;</span></span><br><span class="line">    <span class="comment">#$geoip2_data_country_code default=CN source=$variable_with_ip country iso_code;</span></span><br><span class="line">    <span class="string">$geoip2_data_country_code</span> <span class="string">default=CN</span> <span class="string">country</span> <span class="string">iso_code;</span></span><br><span class="line">    <span class="string">$geoip2_data_country_name</span> <span class="string">country</span> <span class="string">names</span> <span class="string">zh-CN;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">fastcgi_param</span> <span class="string">COUNTRY_CODE</span> <span class="string">$geoip2_data_country_code;</span></span><br><span class="line"><span class="string">fastcgi_param</span> <span class="string">COUNTRY_NAME</span> <span class="string">$geoip2_data_country_name;</span></span><br><span class="line"><span class="string">fastcgi_param</span> <span class="string">CITY_NAME</span>    <span class="string">$geoip2_data_city_name;</span></span><br></pre></td></tr></table></figure>

<h2 id="é¢å¤–è§„åˆ™"><a href="#é¢å¤–è§„åˆ™" class="headerlink" title="é¢å¤–è§„åˆ™"></a>é¢å¤–è§„åˆ™</h2><p>extra.rules</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é GET HEAD POST è¯·æ±‚ä¸€å¾‹ 444</span></span><br><span class="line"><span class="string">if</span> <span class="string">($request_method</span> <span class="type">!~</span> <span class="string">^(GET|HEAD|POST)$</span> <span class="string">)</span> &#123;</span><br><span class="line">  <span class="string">return</span> <span class="number">444</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># éè®¸å¯ host ä¸€å¾‹ 444</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬æ¥è¯´ä½ å¯¹å¤–å¼€æ”¾çš„ç«™ç‚¹éƒ½å¯ä»¥æ”¾è¿›å»</span></span><br><span class="line"><span class="string">if</span> <span class="string">($host</span> <span class="type">!~*</span> <span class="string">^(aaa.com|b.aaa.com|c.ddd.com)$)</span> &#123;</span><br><span class="line">  <span class="string">return</span> <span class="number">444</span><span class="string">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Naxsi-è§„åˆ™"><a href="#Naxsi-è§„åˆ™" class="headerlink" title="Naxsi è§„åˆ™"></a>Naxsi è§„åˆ™</h2><p>naxsi.rules | ä¸åŒäº Naxsi æ ¸å¿ƒè§„åˆ™ | å‚è§ <a href="https://github.com/nbs-system/naxsi/wiki/naxsi-setup">å®˜æ–¹è¯´æ˜</a></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">SecRulesEnabled;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤å¤„å¯¹åº”ä¸‹æ–‡ç«™ç‚¹é…ç½®ä¸­çš„ Naxsi å“åº”</span></span><br><span class="line"><span class="string">DeniedUrl</span> <span class="string">&quot;/RequestDenied&quot;</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="string">CheckRule</span> <span class="string">&quot;$SQL &gt;= 8&quot;</span> <span class="string">BLOCK;</span></span><br><span class="line"><span class="string">CheckRule</span> <span class="string">&quot;$RFI &gt;= 8&quot;</span> <span class="string">BLOCK;</span></span><br><span class="line"><span class="string">CheckRule</span> <span class="string">&quot;$TRAVERSAL &gt;= 4&quot;</span> <span class="string">BLOCK;</span></span><br><span class="line"><span class="string">CheckRule</span> <span class="string">&quot;$EVADE &gt;= 4&quot;</span> <span class="string">BLOCK;</span></span><br><span class="line"><span class="string">CheckRule</span> <span class="string">&quot;$XSS &gt;= 8&quot;</span> <span class="string">BLOCK;</span></span><br></pre></td></tr></table></figure>

<h2 id="ç«™ç‚¹é…ç½®"><a href="#ç«™ç‚¹é…ç½®" class="headerlink" title="ç«™ç‚¹é…ç½®"></a>ç«™ç‚¹é…ç½®</h2><p>vhost/*.conf</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ— å…³é…ç½®ä¸å†èµ˜è¿°</span></span><br><span class="line"></span><br><span class="line"><span class="string">server</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># 80 è½¬ 443</span></span><br><span class="line">        <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">        <span class="string">return</span> <span class="number">301</span> <span class="string">https://$server_name$request_uri;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="string">server</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">listen</span> <span class="number">443</span> <span class="string">ssl</span> <span class="string">http2;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é¢å¤–å“åº”</span></span><br><span class="line">	<span class="string">include</span> <span class="string">extra.rules;</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment"># Naxsi å“åº”</span></span><br><span class="line">        <span class="string">location</span> <span class="string">/RequestDenied</span> &#123;</span><br><span class="line">            <span class="string">return</span> <span class="number">444</span><span class="string">;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">            <span class="comment"># Naxsi çš„å…·ä½“è§„åˆ™ï¼Œå®šä¹‰äº†å“åº”è½¬å‘ /RequestDenied</span></span><br><span class="line">            <span class="string">include</span> <span class="string">naxsi.rules;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å›½åˆ«å“åº”</span></span><br><span class="line">            <span class="string">if</span> <span class="string">($Country_Policy</span> <span class="string">=</span> <span class="number">1</span><span class="string">)</span> &#123;</span><br><span class="line">                <span class="string">return</span> <span class="number">444</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># ä½ ä¹Ÿå¯ä»¥åŸºäº $Country_Policy æ¥ä¸€ä¸ªå…«å›½è¯­è¨€çš„é—®å€™</span></span><br><span class="line">                <span class="comment">#add_header Content-Type &quot;text/plain;charset=utf-8&quot;;</span></span><br><span class="line">                <span class="comment">#return 200 &quot;Your IP Has Been banned!&quot;;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”¨æˆ·ä»£ç†å“åº”</span></span><br><span class="line">        <span class="string">if</span> <span class="string">($UA_Policy</span> <span class="string">=</span> <span class="number">1</span><span class="string">)</span> &#123;</span><br><span class="line">            <span class="string">return</span> <span class="number">444</span><span class="string">;</span></span><br><span class="line">            <span class="comment">#return http://127.0.0.1;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="Fail2ban-è®¾ç½®"><a href="#Fail2ban-è®¾ç½®" class="headerlink" title="Fail2ban è®¾ç½®"></a>Fail2ban è®¾ç½®</h1><h2 id="è­¦å‘Š"><a href="#è­¦å‘Š" class="headerlink" title="è­¦å‘Š"></a>è­¦å‘Š</h2><p><mark>é‡è¦çš„è­¦å‘Šæ”¾å‰é¢ï¼Œå› ä¸ºæˆ‘å·²ç»å®Œæˆäº†å„ç§æµ‹è¯•ï¼Œè‡ªæˆ‘æ„Ÿè§‰æ–¹æ¡ˆæˆç†Ÿæ‰€ä»¥å°†å°ç¦è®¾ä¸º 72 å°æ—¶ã€‚<br>å¦‚æœä½ è¦æµ‹è¯•ï¼ˆä½ è‚¯å®šå¾—æµ‹è¯•ï¼‰ï¼Œè¯·åŠ¡å¿…å°† bantime è®¾ä¸ºçŸ­æ—¶é•¿æ¯”å¦‚ 1mï¼ˆä¸€åˆ†é’Ÿï¼‰ï¼Œå¦åˆ™ä½ çš„æµ‹è¯• IP å¯èƒ½ä¸€é”®å»ä¸–ã€‚</mark></p>
<h2 id="ç›‘æ§-access-log"><a href="#ç›‘æ§-access-log" class="headerlink" title="ç›‘æ§ access_log"></a>ç›‘æ§ access_log</h2><ul>
<li>æ–°å¢ 444 ç›‘ç‹±</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/fail2ban/jail.d/nginx-444.conf &lt;&lt; EOF</span><br><span class="line">[nginx-444]</span><br><span class="line">enabled  = <span class="literal">true</span></span><br><span class="line">port     = http,https</span><br><span class="line">filter   = nginx-444</span><br><span class="line">logpath  = /var/<span class="built_in">log</span>/nginx/*access.log</span><br><span class="line">maxretry = 1</span><br><span class="line">findtime = 1m</span><br><span class="line">bantime  = 72h</span><br><span class="line">action   = iptables[name=nginx, port=<span class="string">&quot;0:65535&quot;</span>, protocol=tcp]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ul>
<li>æ–°å¢ 444 åŒ¹é…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/fail2ban/filter.d/nginx-444.conf &lt;&lt; EOF</span><br><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line">failregex = ^&lt;HOST&gt; -.*444 0.*</span><br><span class="line"></span><br><span class="line">ignoreregex =</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="ç›‘æ§-error-log"><a href="#ç›‘æ§-error-log" class="headerlink" title="ç›‘æ§ error_log"></a>ç›‘æ§ error_log</h2><ul>
<li>æ–°å¢ naxsi ç›‘ç‹±</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/fail2ban/jail.d/nginx-naxsi.conf &lt;&lt; EOF</span><br><span class="line">[nginx-naxsi]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">port = http,https</span><br><span class="line">filter = nginx-naxsi</span><br><span class="line">logpath = /var/<span class="built_in">log</span>/nginx/*error.log</span><br><span class="line">maxretry = 6</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ul>
<li>æ–°å¢ naxsi åŒ¹é…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/fail2ban/filter.d/nginx-naxsi.conf &lt;&lt; EOF</span><br><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line">failregex = NAXSI_FMT: ip=&lt;HOST&gt;.*&amp;config=block</span><br><span class="line"></span><br><span class="line">ignoreregex = NAXSI_FMT: ip=&lt;HOST&gt;.*&amp;config=learning</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="é‡å¯-éªŒè¯-Fail2ban"><a href="#é‡å¯-éªŒè¯-Fail2ban" class="headerlink" title="é‡å¯/éªŒè¯ Fail2ban"></a>é‡å¯/éªŒè¯ Fail2ban</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fail2ban-client --<span class="built_in">test</span></span><br><span class="line">service fail2ban restart</span><br><span class="line">fail2ban-client ping</span><br><span class="line">fail2ban-client status</span><br><span class="line">iptables -L | grep nginx</span><br></pre></td></tr></table></figure>

<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>å‡è®¾ä½ æŒ‰éƒ¨å°±ç­åœ°å¸ƒç½®å¥½ä¸€åˆ‡ï¼Œå¯ä»¥é€šè¿‡ curl è§¦å‘å°ç¦ã€‚<br>å†æ¬¡è­¦å‘Šï¼Œè¯·åŠ¡å¿…å°† bantime è®¾ç½®ä¸ºçŸ­æ—¶é•¿æ¯”å¦‚ 1mã€‚<br>å¦å¤–ï¼Œåœ¨ç¡®è®¤æµ‹è¯•ç»“æœè‰¯å¥½åï¼Œä½ å¯èƒ½éœ€è¦åˆ é™¤ <strong>Fail2ban æ•°æ®åº“</strong>å¹¶å¤åŸ bantime è®¾ç½®æœ€åå†æ¬¡é‡å¯ Fail2banã€‚</p>
<h2 id="æœ¬åœ°æ“ä½œ"><a href="#æœ¬åœ°æ“ä½œ" class="headerlink" title="æœ¬åœ°æ“ä½œ"></a>æœ¬åœ°æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­£å¸¸è®¿é—®ä½ çš„ç½‘ç«™ï¼ŒNginx æ­£å¸¸å“åº”</span></span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥æµè§ˆå™¨è®¿é—®ï¼Œéƒ½ä¸ä¼šè§¦å‘ 444</span></span><br><span class="line">curl https://ä½ çš„ç½‘ç«™</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ç©ºç™½ UA è®¿é—®ï¼Œç«‹åˆ»è§¦å‘ Nginx ç”¨æˆ·ä»£ç†å“åº”</span></span><br><span class="line"><span class="comment"># Nginx è¿”å› 444ï¼ŒFail2ban æ•è·åˆ°æ—¥å¿—</span></span><br><span class="line"><span class="comment"># æ­¤åˆ»å¼€å§‹ä½ çš„æµ‹è¯• IP å°†ä¼šè¢«å°ç¦ 1 åˆ†é’Ÿ</span></span><br><span class="line">curl -A <span class="string">&quot;&quot;</span> https://ä½ çš„ç½‘ç«™</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®æˆ–è€…åˆ·æ–°ä½ çš„ç½‘ç«™ï¼Œæ‰“ä¸å¼€å°±å¯¹äº†</span></span><br><span class="line"><span class="comment"># ä¸€åˆ†é’Ÿè¿‡å IP è§£å°</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿œç¨‹æ“ä½œ"><a href="#è¿œç¨‹æ“ä½œ" class="headerlink" title="è¿œç¨‹æ“ä½œ"></a>è¿œç¨‹æ“ä½œ</h2><ul>
<li>éªŒè¯</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tail -f /var/<span class="built_in">log</span>/fail2ban.log</span><br><span class="line">2019-02-10 00:59:13,689 fail2ban.actions        [17110]: NOTICE  [nginx-444] Ban 222.93.xxx.xx</span><br><span class="line">2019-02-10 01:00:13,786 fail2ban.actions        [17110]: NOTICE  [nginx-444] Unban 222.93.xxx.xx</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¢å¤</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service fail2ban stop</span><br><span class="line">rm -rf /var/lib/fail2ban/fail2ban.sqlite3</span><br><span class="line">service fail2ban start</span><br></pre></td></tr></table></figure>

<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><ul>
<li>Nginx æœ¬èº«æ”¯æŒ deny IPï¼Œæˆ‘æ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</li>
<li>Fail2ban å•ç‹¬ä½¿ç”¨ä¹Ÿå¯ä»¥å°ç¦æ¶æ„è®¿é—®ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯è¯»å–æ—¥å¿—ç„¶åè¿›è¡Œé˜²ç«å¢™æ“ä½œã€‚</li>
<li>iptables ä¹Ÿä¸æ˜¯å”¯ä¸€é€‰æ‹©ï¼Œè¿˜æ”¯æŒ nftablesã€firewalld ç­‰ç­‰ã€‚</li>
<li>é™æµæ–¹é¢çš„é…ç½®æš‚æ—¶æ²¡æœ‰æ¶‰åŠï¼Œä»¥åæœ‰æœºä¼šå†è¡Œè¡¥å……ã€‚</li>
</ul>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul>
<li><a href="https://github.com/mariusv/nginx-badbot-blocker">Nginx Bad Bot Blocker</a></li>
<li><a href="https://github.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker">Nginx Ultimate Bad Bot Blocker</a></li>
<li><a href="https://www.fail2ban.org/wiki/index.php/Commands">Commands - Fail2ban</a></li>
<li><a href="https://github.com/nbs-system/naxsi/wiki/integration-fail2ban">ntegration fail2ban</a></li>
<li><a href="https://www.linode.com/docs/security/using-fail2ban-for-security/">Use Fail2ban to Secure Your Server</a></li>
<li><a href="https://easyengine.io/tutorials/nginx/log-parsing">Parsing access.log and error.logs using linux commands</a></li>
</ul>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>444</tag>
        <tag>Fail2ban</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¼–è¯‘å®‰è£… NGINX</title>
    <url>/post/compiling-and-installing-nginx.html</url>
    <content><![CDATA[<div class="note info"><p>æœ¬æ–‡ç¿»è¯‘ä¿®æ”¹è‡ª <a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#compiling-and-installing-from-source">NGINX Docs | Installing NGINX Open Source</a>.</p>
</div>

<p>ç›¸å¯¹äºé¢„æ„å»ºè½¯ä»¶åŒ…ï¼Œä»æºä»£ç ç¼–è¯‘ NGINX çš„å¼€æºç‰ˆæœ¬æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œä½ å¯ä»¥ä» NGINX æˆ–è€…ç¬¬ä¸‰æ–¹æ·»åŠ ç‰¹å®šæ¨¡å—ï¼Œå¹¶åº”ç”¨æœ€æ–°çš„å®‰å…¨è¡¥ä¸ã€‚<a id="more"></a></p>
<h1 id="å®‰è£…-NGINX-ä¾èµ–"><a href="#å®‰è£…-NGINX-ä¾èµ–" class="headerlink" title="å®‰è£… NGINX ä¾èµ–"></a>å®‰è£… NGINX ä¾èµ–</h1><p>åœ¨æœ€ç»ˆç¼–è¯‘ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦å®‰è£…å¤šä¸ªä¾èµ–ï¼š</p>
<ul>
<li><a href="https://www.pcre.org/">PCRE</a> - æä¾›æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒï¼ŒNGINX <a href="https://nginx.org/en/docs/ngx_core_module.html">Core</a> ä»¥åŠ <a href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html">Rewrite</a> æ¨¡å—æ‰€éœ€ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz</span><br><span class="line">tar -zxf pcre-8.43.tar.gz</span><br><span class="line"><span class="built_in">cd</span> pcre-8.43</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.zlib.net/">zlib</a> - æä¾›æŠ¥å¤´å‹ç¼©æ”¯æŒï¼ŒNGINX <a href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html">Gzip</a> æ¨¡å—æ‰€éœ€ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://www.zlib.net/zlib-1.2.11.tar.gz</span><br><span class="line">tar -zxf zlib-1.2.11.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zlib-1.2.11</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.openssl.org/">OpenSSL</a> - æä¾› HTTPS åè®®æ”¯æŒï¼ŒNGINX <a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html">SSL</a> æ¨¡å—æ‰€éœ€ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.1d.tar.gz</span><br><span class="line">tar -zxf openssl-1.1.1d.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1d</span><br><span class="line">./configure darwin64-x86_64-cc --prefix=/usr</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‹è½½æºç "><a href="#ä¸‹è½½æºç " class="headerlink" title="ä¸‹è½½æºç "></a>ä¸‹è½½æºç </h1><p>ä» <a href="https://nginx.org/en/download.html">nginx.org</a> ä¸‹è½½ç¨³å®šç‰ˆæœ¬æˆ–ä¸»çº¿ç‰ˆæœ¬çš„æºç ã€‚</p>
<p>ä¸‹è½½å¹¶è§£å‹æœ€æ–°ä¸»çº¿ç‰ˆæœ¬çš„æºç ï¼Œè¯·è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://nginx.org/download/nginx-1.17.3.tar.gz</span><br><span class="line">tar zxf nginx-1.17.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.17.3</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½å¹¶è§£å‹æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„æºç ï¼Œè¯·è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://nginx.org/download/nginx-1.16.1.tar.gz</span><br><span class="line">tar zxf nginx-1.16.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.16.1</span><br></pre></td></tr></table></figure>

<h1 id="é…ç½®æ„å»ºé€‰é¡¹"><a href="#é…ç½®æ„å»ºé€‰é¡¹" class="headerlink" title="é…ç½®æ„å»ºé€‰é¡¹"></a>é…ç½®æ„å»ºé€‰é¡¹</h1><p>é…ç½®é€‰é¡¹ç”± ./configure è„šæœ¬è®¾ç½®å„ç§ NGINX å‚æ•°æ¥å£°æ˜ï¼ŒåŒ…æ‹¬æºç è·¯å¾„ã€è¿æ¥å¤„ç†æ–¹æ³•ä»¥åŠæ¨¡å—åˆ—è¡¨ã€‚è„šæœ¬è¿è¡Œå®Œæ¯•åå°†ä¼šåˆ›å»ºç¼–è¯‘ NGINX æ‰€éœ€çš„ Makefile æ–‡ä»¶ã€‚</p>
<p>é…ç½®è„šæœ¬ä½¿ç”¨ç¤ºä¾‹ï¼ˆä½¿ç”¨ \ å®ç°æ¢è¡Œï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--sbin-path=/usr/<span class="built_in">local</span>/nginx/nginx \</span><br><span class="line">--conf-path=/usr/<span class="built_in">local</span>/nginx/nginx.conf \</span><br><span class="line">--pid-path=/usr/<span class="built_in">local</span>/nginx/nginx.pid \</span><br><span class="line">--with-pcre=../pcre-8.42 \</span><br><span class="line">--with-zlib=../zlib-1.2.11 \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-mail=dynamic \</span><br><span class="line">--add-module=/usr/build/nginx-rtmp-module \</span><br><span class="line">--add-dynamic-module=/usr/build/3party_module</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®-NGINX-è·¯å¾„"><a href="#é…ç½®-NGINX-è·¯å¾„" class="headerlink" title="é…ç½® NGINX è·¯å¾„"></a>é…ç½® NGINX è·¯å¾„</h2><p>é…ç½®è„šæœ¬å…è®¸è®¾ç½® NGINX äºŒè¿›åˆ¶æ–‡ä»¶ã€é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¹Ÿæ”¯æŒè®¾ç½®ä¾èµ–åº“ï¼ˆå¦‚ PCRE æˆ– SSLï¼‰çš„è·¯å¾„ï¼Œä»¥ä¾¿å°†å®ƒä»¬é™æ€é“¾æ¥åˆ° NGINX äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>â€“prefix=&lt;PATH&gt;</td>
<td>NGINX çš„å®‰è£…ç›®å½•ï¼Œé…ç½®è„šæœ¬ï¼ˆä¸åŒ…æ‹¬åº“çš„è·¯å¾„ï¼‰è®¾ç½®ä¸­çš„ NGINX ç¼ºçœè·¯å¾„ç›¸å¯¹äºæ­¤ç›®å½•ã€‚é»˜è®¤å€¼ï¼š/usr/local/nginxã€‚</td>
</tr>
<tr>
<td>â€“sbin-path=&lt;PATH&gt;</td>
<td>NGINX å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼Œä»…åœ¨å®‰è£…æœŸé—´ä½¿ç”¨ã€‚é»˜è®¤å€¼ï¼š&lt;prefix&gt;/sbin/nginxã€‚</td>
</tr>
<tr>
<td>â€“conf-path=&lt;PATH&gt;</td>
<td>NGINX é…ç½®æ–‡ä»¶è·¯å¾„ã€‚ä½ å¯ä»¥é€šè¿‡ nginx å‘½ä»¤è¡Œä½¿ç”¨ -c &lt;FILENAME&gt; æŒ‡å®šå…¶ä»–æ–‡ä»¶æ¥è¦†ç›–æ­¤è®¾ç½®ã€‚é»˜è®¤å€¼ï¼š&lt;prefix&gt;/conf/nginx.confã€‚</td>
</tr>
<tr>
<td>â€“pid-path=&lt;PATH&gt;</td>
<td>nginx.pid æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå­˜å‚¨ nginx ä¸»è¿›ç¨‹çš„è¿›ç¨‹ID ã€‚å®‰è£…åå¯ä»¥ä½¿ç”¨ NGINX é…ç½®æ–‡ä»¶ä¸­çš„ <a href="https://nginx.org/en/docs/ngx_core_module.html#pid">pid</a> æŒ‡ä»¤æ›´æ”¹ã€‚é»˜è®¤å€¼ï¼š&lt;prefix&gt;/logs/nginx.pidã€‚</td>
</tr>
<tr>
<td>â€“error-log-path=&lt;PATH&gt;</td>
<td>é”™è¯¯ï¼Œè­¦å‘Šå’Œè¯Šæ–­æ•°æ®çš„ä¸»æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚å®‰è£…åå¯ä»¥ä½¿ç”¨ NGINX é…ç½®æ–‡ä»¶ä¸­çš„ <a href="https://nginx.org/en/docs/ngx_core_module.html#error_log">error_log</a> æŒ‡ä»¤æ›´æ”¹ã€‚é»˜è®¤å€¼ï¼š&lt;prefix&gt;/logs/error.logã€‚</td>
</tr>
<tr>
<td>â€“http-log-path=&lt;PATH&gt;</td>
<td>è®°å½• HTTP è¯·æ±‚çš„ä¸»æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è®¿é—®æ—¥å¿—ã€‚å®‰è£…ååŒæ ·å¯ä»¥ä½¿ç”¨ NGINX é…ç½®æ–‡ä»¶ä¸­çš„ <a href="https://nginx.org/en/docs/http/ngx_http_log_module.html#access_log">access_log</a> æŒ‡ä»¤è¿›è¡Œä¿®æ”¹ã€‚é»˜è®¤å€¼ï¼š&lt;prefix&gt;/logs/access.logã€‚</td>
</tr>
<tr>
<td>â€“user=&lt;NAME&gt;</td>
<td>NGINX å·¥ä½œè¿›ç¨‹ä½¿ç”¨å…¶å‡­æ®çš„éç‰¹æƒç”¨æˆ·çš„åç§°ã€‚å®‰è£…åå¯ä»¥ä½¿ç”¨ NGINX é…ç½®æ–‡ä»¶ä¸­çš„ <a href="https://nginx.org/en/docs/ngx_core_module.html#user">user</a> æŒ‡ä»¤æ›´æ”¹ã€‚é»˜è®¤ï¼šnobodyã€‚</td>
</tr>
<tr>
<td>â€“group=&lt;NAME&gt;</td>
<td>NGINXå·¥ä½œè¿›ç¨‹ä½¿ç”¨å…¶å‡­æ®çš„ç»„çš„åç§°ã€‚å®‰è£…åå¯ä»¥ä½¿ç”¨ NGINX é…ç½®æ–‡ä»¶ä¸­çš„ <a href="https://nginx.org/en/docs/ngx_core_module.html#user">user</a> æŒ‡ä»¤æ›´æ”¹ã€‚é»˜è®¤å€¼ï¼šâ€“user é€‰é¡¹è®¾å®šçš„å€¼ã€‚</td>
</tr>
<tr>
<td>â€“with-pcre=&lt;PATH&gt;</td>
<td>PCRE åº“æºä»£ç çš„è·¯å¾„ï¼Œ<a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location">location</a> æŒ‡ä»¤å’Œ <a href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html">Rewrite</a> æ¨¡å—æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒæ‰€éœ€ã€‚</td>
</tr>
<tr>
<td>â€“with-pcre-jit</td>
<td>å¯ç”¨å³æ—¶ç¼–è¯‘æ”¯æŒï¼ˆ<a href="https://nginx.org/en/docs/ngx_core_module.html#pcre_jit">pcre_jit</a> æŒ‡ä»¤ï¼‰æ„å»º PCRE åº“ã€‚</td>
</tr>
<tr>
<td>â€“with-zlib=&lt;PATH&gt;</td>
<td>zlib åº“çš„æºä»£ç è·¯å¾„ï¼Œ<a href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html">Gzip</a> æ¨¡å—éœ€è¦è¯¥è·¯å¾„ã€‚</td>
</tr>
</tbody></table>
<h2 id="é…ç½®-NGINX-GCC-é€‰é¡¹"><a href="#é…ç½®-NGINX-GCC-é€‰é¡¹" class="headerlink" title="é…ç½® NGINX GCC é€‰é¡¹"></a>é…ç½® NGINX GCC é€‰é¡¹</h2><p>ä½¿ç”¨é…ç½®è„šæœ¬ï¼Œä½ è¿˜å¯ä»¥æŒ‡å®šä¸ç¼–è¯‘å™¨ç›¸å…³çš„é€‰é¡¹ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>â€“with-cc-opt=â€&lt;PARAMETERS&gt;â€</td>
<td>é¢å¤–æ·»åŠ åˆ° CFLAGS å˜é‡çš„å‚æ•°ã€‚FreeBSD ä¸‹ä½¿ç”¨ç³»ç»Ÿçš„ PCRE åº“ç¼–è¯‘æ—¶å¼ºåˆ¶å€¼ä¸º â€“with-cc-opt=â€-I /usr/local/includeâ€ã€‚å¦‚æœæƒ³å¢åŠ  select() æ‰€æ”¯æŒçš„æ–‡ä»¶æ•°é‡ä¹Ÿå¯ä»¥åœ¨æ­¤å£°æ˜ï¼Œæ¯”å¦‚ â€“with-cc-opt=â€-D FD_SETSIZE=2048â€ã€‚</td>
</tr>
<tr>
<td>â€“with-ld-opt=â€&lt;PARAMETERS&gt;â€</td>
<td>é“¾æ¥æ‰€éœ€çš„é¢å¤–å‚æ•°ã€‚FreeBSD ä¸‹ä½¿ç”¨ç³»ç»Ÿçš„ PCRE åº“ç¼–è¯‘æ—¶å¼ºåˆ¶å€¼ä¸º â€“with-ld-opt= â€œ-L /usr/local/libâ€ã€‚</td>
</tr>
</tbody></table>
<h2 id="æŒ‡å®š-NGINX-è¿æ¥å¤„ç†æ–¹æ³•"><a href="#æŒ‡å®š-NGINX-è¿æ¥å¤„ç†æ–¹æ³•" class="headerlink" title="æŒ‡å®š NGINX è¿æ¥å¤„ç†æ–¹æ³•"></a>æŒ‡å®š NGINX è¿æ¥å¤„ç†æ–¹æ³•</h2><p>ä½¿ç”¨é…ç½®è„šæœ¬ï¼Œä½ å¯ä»¥é‡æ–°å®šä¹‰åŸºäºäº‹ä»¶çš„è½®è¯¢çš„æ–¹æ³•ã€‚å‚é˜… NGINX æ–‡æ¡£ä¸­çš„ <a href="https://nginx.org/en/docs/events.html">Connection processing methods</a> è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>â€“with-select_module, â€“without-select_module</td>
<td>å¯ç”¨æˆ–ç¦ç”¨å®ç° select() æ”¯æŒçš„æ¨¡å—ï¼Œå¦‚æœç³»ç»Ÿä¸æ”¯æŒæ›´åˆé€‚çš„æ–¹æ³•ï¼ˆå¦‚ kqueueï¼Œepoll æˆ– /dev/pollï¼‰åˆ™ä¼šè‡ªåŠ¨æ„å»ºæ­¤æ¨¡å—ã€‚</td>
</tr>
<tr>
<td>â€“with-poll_module, â€“without-poll_module</td>
<td>å¯ç”¨æˆ–ç¦ç”¨å®ç° poll() æ”¯æŒçš„æ¨¡å—ï¼Œå¦‚æœç³»ç»Ÿä¸æ”¯æŒæ›´åˆé€‚çš„æ–¹æ³•ï¼ˆå¦‚ kqueueï¼Œepoll æˆ– /dev/pollï¼‰åˆ™ä¼šè‡ªåŠ¨æ„å»ºæ­¤æ¨¡å—ã€‚</td>
</tr>
</tbody></table>
<h2 id="é€‰æ‹©è¦æ„å»ºçš„-NGINX-æ¨¡å—"><a href="#é€‰æ‹©è¦æ„å»ºçš„-NGINX-æ¨¡å—" class="headerlink" title="é€‰æ‹©è¦æ„å»ºçš„ NGINX æ¨¡å—"></a>é€‰æ‹©è¦æ„å»ºçš„ NGINX æ¨¡å—</h2><p>NGINX ç”±å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„æ¨¡å—ç»„æˆï¼Œè¿™äº›æ¨¡å—å¯ä»¥é€šè¿‡é…ç½®è„šæœ¬åŒ…å«é€‰é¡¹æ¥æŒ‡å®šæ„å»ºã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ NGINX ä¼šæ„å»ºè‹¥å¹²æ¨¡å— - ä¸å¿…ä½¿ç”¨é…ç½®è„šæœ¬æŒ‡å®šå®ƒä»¬ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>--without-&lt;MODULE-NAME&gt;</code> é€‰é¡¹æ˜ç¡®æ’é™¤ç‰¹å®šçš„æ¨¡å—ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹æœªåŒ…å«çš„æ¨¡å—ä»¥åŠç¬¬ä¸‰æ–¹æ¨¡å—å¿…é¡»åœ¨é…ç½®è„šæœ¬ä¸­ä¸å…¶ä»–æ„å»ºé€‰é¡¹ä¸€èµ·æ˜¾å¼æŒ‡å®šã€‚è¿™äº›æ¨¡å—å¯ä»¥é™æ€é“¾æ¥ï¼ˆæ¯æ¬¡ NGINX å¯åŠ¨æ—¶åŠ è½½å®ƒä»¬ï¼‰æˆ–è€…åŠ¨æ€é“¾æ¥ï¼ˆåªæœ‰åœ¨ NGINX é…ç½®æ–‡ä»¶ä¸­åŒ…å«ç›¸å…³æŒ‡ä»¤æ—¶æ‰åŠ è½½å®ƒä»¬ï¼‰åˆ° NGINX äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<h2 id="é»˜è®¤æ„å»ºçš„æ¨¡å—"><a href="#é»˜è®¤æ„å»ºçš„æ¨¡å—" class="headerlink" title="é»˜è®¤æ„å»ºçš„æ¨¡å—"></a>é»˜è®¤æ„å»ºçš„æ¨¡å—</h2><p>å¦‚æœä½ ä¸éœ€è¦æŸä¸ªé»˜è®¤æ„å»ºçš„æ¨¡å—ï¼Œä½ å¯ä»¥é€šè¿‡é…ç½®è„šæœ¬ä½¿ç”¨ <code>--without-&lt;MODULE-NAME&gt;</code> é€‰é¡¹è¿›è¡Œæ’é™¤ï¼Œä»¥ä¸‹ç¤ºä¾‹ç¦ç”¨äº† <a href="https://nginx.org/en/docs/http/ngx_http_empty_gif_module.html">Empty GIF</a> æ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--sbin-path=/usr/<span class="built_in">local</span>/nginx/nginx \</span><br><span class="line">--conf-path=/usr/<span class="built_in">local</span>/nginx/nginx.conf \</span><br><span class="line">--pid-path=/usr/<span class="built_in">local</span>/nginx/nginx.pid \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-pcre=../pcre-8.43 \</span><br><span class="line">--with-zlib=../zlib-1.2.11 \</span><br><span class="line">--without-http_empty_gif_module</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_access_module.html">http_access_module</a></td>
<td>æ¥å—æˆ–æ‹’ç»æ¥è‡ªæŒ‡å®šå®¢æˆ·ç«¯åœ°å€çš„è¯·æ±‚ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html">http_auth_basic_module</a></td>
<td>é€šè¿‡ä½¿ç”¨ HTTP åŸºæœ¬èº«ä»½éªŒè¯åè®®éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ¥é™åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_autoindex_module.html">http_autoindex_module</a></td>
<td>å¤„ç†ä»¥æ­£æ–œæ å­—ç¬¦ / ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_browser_module.html">http_browser_module</a></td>
<td>åˆ›å»ºå…¶å€¼å–å†³äº User-Agent è¯·æ±‚æ ‡å¤´å€¼çš„å˜é‡ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_charset_module.html">http_charset_module</a></td>
<td>å°†æŒ‡å®šçš„å­—ç¬¦é›†æ·»åŠ åˆ° Content-Type å“åº”æ ‡å¤´ã€‚å¯ä»¥å°†æ•°æ®ä»ä¸€ä¸ªå­—ç¬¦é›†è½¬æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦é›†ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_empty_gif_module.html">http_empty_gif_module</a></td>
<td>å‘å‡ºå•åƒç´ é€æ˜ GIFã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html">http_fastcgi_module</a></td>
<td>å°†è¯·æ±‚ä¼ é€’ç»™ FastCGI æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_geo_module.html">http_geo_module</a></td>
<td>ä½¿ç”¨å–å†³äºå®¢æˆ·ç«¯ IP åœ°å€çš„å€¼åˆ›å»ºå˜é‡ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html">http_gzip_module</a></td>
<td>ä½¿ç”¨ gzip å‹ç¼©å“åº”ï¼Œå°†ä¼ è¾“æ•°æ®é‡å‡å°‘ä¸€åŠæˆ–æ›´å¤šã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_limit_conn_module.html">http_limit_conn_module</a></td>
<td>é™åˆ¶æ¯ä¸ªå®šä¹‰å¯†é’¥çš„è¿æ¥æ•°ï¼Œç‰¹åˆ«æ˜¯æ¥è‡ªå•ä¸ª IP åœ°å€çš„è¿æ¥æ•°ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_limit_req_module.html">http_limit_req_module</a></td>
<td>é™åˆ¶æ¯ä¸ªå®šä¹‰å¯†é’¥çš„è¯·æ±‚å¤„ç†é€Ÿç‡ï¼Œç‰¹åˆ«æ˜¯æ¥è‡ªå•ä¸ª IP åœ°å€çš„è¯·æ±‚çš„å¤„ç†é€Ÿç‡ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_map_module.html">http_map_module</a></td>
<td>åˆ›å»ºå…¶å€¼å–å†³äºå…¶ä»–å˜é‡å€¼çš„å˜é‡ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_memcached_module.html">http_memcached_module</a></td>
<td>å°†è¯·æ±‚ä¼ é€’ç»™ memcached æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html">http_proxy_module</a></td>
<td>å°† HTTP è¯·æ±‚ä¼ é€’ç»™å¦ä¸€å°æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_referer_module.html">http_referer_module</a></td>
<td>åœ¨ Referer æ ‡å¤´ä¸­é˜»æ­¢å…·æœ‰æ— æ•ˆå€¼çš„è¯·æ±‚ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html">http_rewrite_module</a></td>
<td>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›´æ”¹è¯·æ±‚ URI å¹¶è¿”å›é‡å®šå‘; æœ‰æ¡ä»¶åœ°é€‰æ‹©é…ç½®ã€‚éœ€è¦ <a href="https://www.pcre.org/">PCRE</a> åº“ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_scgi_module.html">http_scgi_module</a></td>
<td>å°†è¯·æ±‚ä¼ é€’ç»™ SCGI æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_ssi_module.html">http_ssi_module</a></td>
<td>åœ¨é€šè¿‡å®ƒçš„å“åº”ä¸­å¤„ç† SSIï¼ˆæœåŠ¡å™¨ç«¯åŒ…å«ï¼‰å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_split_clients_module.html">http_split_clients_module</a></td>
<td>åˆ›å»ºé€‚åˆ A/B æµ‹è¯•çš„å˜é‡ï¼Œä¹Ÿç§°ä¸ºæ‹†åˆ†æµ‹è¯•ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#hash">http_upstream_hash_module</a></td>
<td>å¯ç”¨é€šç”¨å“ˆå¸Œè´Ÿè½½å¹³è¡¡æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ip_hash">http_upstream_ip_hash_module</a></td>
<td>å¯ç”¨ IP å“ˆå¸Œè´Ÿè½½å¹³è¡¡æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive">http_upstream_keepalive_module</a></td>
<td>å¯ç”¨ keepalive è¿æ¥.</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#least_conn">http_upstream_least_conn_module</a></td>
<td>å¯ç”¨æœ€å°‘è¿æ¥è´Ÿè½½å¹³è¡¡æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone">http_upstream_zone_module</a></td>
<td>å¯ç”¨å…±äº«å†…å­˜åŒºåŸŸã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_userid_module.html">http_userid_module</a></td>
<td>è®¾ç½®é€‚åˆå®¢æˆ·ç«¯è¯†åˆ«çš„ cookieã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_uwsgi_module.html">http_uwsgi_module</a></td>
<td>å°†è¯·æ±‚ä¼ é€’ç»™ uwsgi æœåŠ¡å™¨ã€‚</td>
</tr>
</tbody></table>
<h2 id="åŒ…å«éé»˜è®¤æ„å»ºçš„æ¨¡å—"><a href="#åŒ…å«éé»˜è®¤æ„å»ºçš„æ¨¡å—" class="headerlink" title="åŒ…å«éé»˜è®¤æ„å»ºçš„æ¨¡å—"></a>åŒ…å«éé»˜è®¤æ„å»ºçš„æ¨¡å—</h2><p>è®¸å¤š NGINX æ¨¡å—é»˜è®¤ä¸è¿›è¡Œæ„å»ºï¼Œå¿…é¡»åœ¨ configure å‘½ä»¤ä¸­é¢å¤–åˆ—å‡ºã€‚</p>
<p><a href="https://nginx.org/en/docs/mail/ngx_mail_core_module.html">mail</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html">stream</a>, <a href="https://nginx.org/en/docs/http/ngx_http_geoip_module.html">geoip</a>, <a href="https://nginx.org/en/docs/http/ngx_http_image_filter_module.html">image_filter</a>, <a href="https://nginx.org/en/docs/http/ngx_http_perl_module.html">perl</a> ä»¥åŠ <a href="https://nginx.org/en/docs/http/ngx_http_xslt_module.html">xslt</a> ç­‰æ¨¡å—å¯ä»¥åŠ¨æ€ç¼–è¯‘ã€‚æµè§ˆ <a href="https://docs.nginx.com/nginx/admin-guide/dynamic-modules/dynamic-modules/">Dynamic Modules</a> æŸ¥çœ‹ç»†èŠ‚ã€‚</p>
<p>configure å‘½ä»¤åŒ…å«éé»˜è®¤æ„å»ºæ¨¡å—çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--sbin-path=/usr/<span class="built_in">local</span>/nginx/nginx \</span><br><span class="line">--conf-path=/usr/<span class="built_in">local</span>/nginx/nginx.conf \</span><br><span class="line">--pid-path=/usr/<span class="built_in">local</span>/nginx/nginx.pid \</span><br><span class="line">--with-pcre=../pcre-8.42 \</span><br><span class="line">--with-zlib=../zlib-1.2.11 \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-mail</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>â€“with-cpp_test_module</td>
<td>æµ‹è¯•å¤´æ–‡ä»¶çš„ C++ å…¼å®¹æ€§ã€‚</td>
</tr>
<tr>
<td>â€“with-debug</td>
<td>å¯ç”¨ <a href="https://docs.nginx.com/nginx/admin-guide/monitoring/debugging/">Debug æ—¥å¿—</a>ã€‚</td>
</tr>
<tr>
<td>â€“with-file-aio</td>
<td>å¯ç”¨å¼‚æ­¥ I/Oã€‚</td>
</tr>
<tr>
<td><a href="http://nginx.org/en/docs/ngx_google_perftools_module.html">â€“with-google_perftools_module</a></td>
<td>å…è®¸ä½¿ç”¨ <a href="https://github.com/gperftools/gperftools">Google Performance tools</a> åº“ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_addition_module.html">â€“with-http_addition_module</a></td>
<td>åœ¨å“åº”å‰åæ·»åŠ æ–‡æœ¬ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_auth_request_module.html">â€“with-http_auth_request_module</a></td>
<td>æ ¹æ®å­è¯·æ±‚çš„ç»“æœå®ç°å®¢æˆ·ç«¯æˆæƒã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_dav_module.html">â€“with-http_dav_module</a></td>
<td>ä½¿ç”¨ WebDAV åè®®å¯ç”¨æ–‡ä»¶ç®¡ç†è‡ªåŠ¨åŒ–ã€‚</td>
</tr>
<tr>
<td>â€“with-http_degradation_module</td>
<td>å…è®¸åœ¨å†…å­˜å¤§å°è¶…è¿‡å®šä¹‰å€¼æ—¶è¿”å›é”™è¯¯ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_flv_module.html">â€“with-http_flv_module</a></td>
<td>ä¸º FLV æ–‡ä»¶æä¾›ä¼ªè§†é¢‘æµæœåŠ¡ç«¯æ”¯æŒã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_geoip_module.html">â€“with-http_geoip_module</a></td>
<td>å…è®¸åˆ›å»ºå–å†³äºå®¢æˆ·ç«¯ IP åœ°å€çš„å˜é‡ã€‚è¯¥æ¨¡å—ä½¿ç”¨ <a href="http://www.maxmind.com/">MaxMind</a> GeoIP æ•°æ®åº“ã€‚è¦ç¼–è¯‘ä¸ºå•ç‹¬çš„åŠ¨æ€æ¨¡å—è¯·å°†é€‰é¡¹æ›´æ”¹ä¸º â€“with-http_geoip_module=dynamicã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_gunzip_module.html">â€“with-http_gunzip_module</a></td>
<td>å¯¹äºä¸æ”¯æŒ <em>zip</em> encoding çš„å®¢æˆ·ç«¯ä½¿ç”¨ Content-Encoding: gzip è§£å‹å“åº”ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_gzip_static_module.html">â€“with-http_gzip_static_module</a></td>
<td>å…è®¸ä½¿ç”¨ .gz æ–‡ä»¶æ‰©å±•åè€Œä¸æ˜¯å¸¸è§„æ–‡ä»¶å‘é€é¢„å‹ç¼©å†…å®¹ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_image_filter_module.html">â€“with-http_image_filter_module</a></td>
<td>ä»¥ JPEGï¼ŒGIFå’ŒPNGæ ¼å¼è½¬æ¢å›¾åƒã€‚è¯¥æ¨¡å—éœ€è¦ <a href="http://libgd.github.io/">LibGD</a> åº“ã€‚è¦ç¼–è¯‘ä¸ºå•ç‹¬çš„åŠ¨æ€æ¨¡å—è¯·å°†é€‰é¡¹æ›´æ”¹ä¸º â€“with-http_image_filter_module=dynamicã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_mp4_module.html">â€“with-http_mp4_module</a></td>
<td>ä¸º MP4 æ–‡ä»¶æä¾›ä¼ªè§†é¢‘æµæœåŠ¡ç«¯æ”¯æŒã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_perl_module.html">â€“with-http_perl_module</a></td>
<td>ç”¨äºåœ¨ Perl ä¸­å®ç°ä½ç½®å’Œå˜é‡å¤„ç†ï¼Œå¹¶å°† Perl è°ƒç”¨æ’å…¥ SSIã€‚éœ€è¦ <a href="https://www.perl.org/get.html">PERL</a> åº“ã€‚è¦ç¼–è¯‘ä¸ºå•ç‹¬çš„åŠ¨æ€æ¨¡å—ï¼Œè¯·å°†é€‰é¡¹æ›´æ”¹ä¸º â€“with-http_perl_module=dynamicã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_random_index_module.html">â€“with-http_random_index_module</a></td>
<td>å¤„ç†ä»¥æ–œæ å­—ç¬¦ / ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶åœ¨æ­¤ç›®å½•ä¸­é€‰æ‹©ä¸€ä¸ªéšæœºæ–‡ä»¶ä½œä¸ºç´¢å¼•æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_realip_module.html">â€“with-http_realip_module</a></td>
<td>å°†å®¢æˆ·ç«¯åœ°å€æ›´æ”¹ä¸ºåœ¨æŒ‡å®šçš„æ ‡å¤´å­—æ®µä¸­å‘é€çš„åœ°å€ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_secure_link_module.html">â€“with-http_secure_link_module</a></td>
<td>ç”¨äºæ£€æŸ¥è¯·æ±‚é“¾æ¥çš„çœŸå®æ€§ï¼Œä¿æŠ¤èµ„æºå…å—æœªç»æˆæƒçš„è®¿é—®ï¼Œå¹¶é™åˆ¶é“¾æ¥çš„ç”Ÿå‘½å‘¨æœŸã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_slice_module.html">â€“with-http_slice_module</a></td>
<td>å…è®¸å°†è¯·æ±‚æ‹†åˆ†ä¸ºå­è¯·æ±‚ï¼Œæ¯ä¸ªå­è¯·æ±‚è¿”å›ä¸€å®šèŒƒå›´çš„å“åº”ã€‚æä¾›æ›´æœ‰æ•ˆçš„å¤§æ–‡ä»¶ç¼“å­˜ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html">â€“with-http_ssl_module</a></td>
<td>å¯ç”¨ HTTPS æ”¯æŒã€‚éœ€è¦ä¸€ä¸ª SSL åº“ï¼Œå¦‚ <a href="https://www.openssl.org/">OpenSSL</a>ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_stub_status_module.html">â€“with-http_stub_status_module</a></td>
<td>æä¾›å¯¹ NGINX åŸºæœ¬çŠ¶æ€ä¿¡æ¯çš„è®¿é—®ã€‚è¯·æ³¨æ„ï¼ŒNGINX Plus ç”¨æˆ·ä¸éœ€è¦æ­¤æ¨¡å—ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æä¾›äº†æ‰©å±•çŠ¶æ€æŒ‡æ ‡å’Œäº¤äº’å¼çš„ä»ªè¡¨æ¿ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_sub_module.html">â€“with-http_sub_module</a></td>
<td>æ›¿æ¢æŒ‡å®šå­—ç¬¦ä¸²æ¥ä¿®æ”¹å“åº”ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_xslt_module.html">â€“with-http_xslt_module</a></td>
<td>ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª XSLT æ ·å¼è¡¨è½¬æ¢ XML å“åº”ã€‚è¯¥æ¨¡å—éœ€è¦ <a href="http://xmlsoft.org/">Libxml2</a> å’Œ <a href="http://xmlsoft.org/XSLT/">XSLT</a> åº“ã€‚è¦ç¼–è¯‘ä¸ºå•ç‹¬çš„åŠ¨æ€æ¨¡å—è¯·å°†é€‰é¡¹æ›´æ”¹ä¸º â€“with-http_xslt_module=dynamicã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_v2_module.html">â€“with-http_v2_module</a></td>
<td>å¯ç”¨ HTTP/2 æ”¯æŒã€‚è®¿é—® <a href="http://www.nginx.com/blog/http2-module-nginx/">The HTTP/2 Module in NGINX</a> è·å–ç»†èŠ‚ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/mail/ngx_mail_core_module.html">â€“with-mail</a></td>
<td>å¯ç”¨é‚®ä»¶ä»£ç†åŠŸèƒ½ã€‚è¦ç¼–è¯‘ä¸ºå•ç‹¬çš„åŠ¨æ€æ¨¡å—è¯·å°†é€‰é¡¹æ›´æ”¹ä¸º â€“with-mail=dynamicã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/mail/ngx_mail_ssl_module.html">â€“with-mail_ssl_module</a></td>
<td>ä¸ºé‚®ä»¶ä»£ç†æœåŠ¡å™¨æä¾› SSL/TLS åè®®æ”¯æŒã€‚éœ€è¦ä¸€ä¸ª SSL åº“ï¼Œå¦‚ <a href="https://www.openssl.org/">OpenSSL</a>ã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html">â€“with-stream</a></td>
<td>å¯ç”¨ TCP å’Œ UDP ä»£ç†åŠŸèƒ½ã€‚è¦ç¼–è¯‘ä¸ºå•ç‹¬çš„åŠ¨æ€æ¨¡å—ï¼Œè¯·å°†é€‰é¡¹æ›´æ”¹ä¸º â€“with-stream=dynamicã€‚</td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/stream/ngx_stream_ssl_module.html">â€“with-stream_ssl_module</a></td>
<td>ä¸ºæµä»£ç†æœåŠ¡å™¨æä¾› SSL/TLS åè®®æ”¯æŒã€‚éœ€è¦ä¸€ä¸ª SSL åº“ï¼Œå¦‚ <a href="https://www.openssl.org/">OpenSSL</a>ã€‚</td>
</tr>
<tr>
<td>â€“with-threads</td>
<td>å¯ç”¨çº¿ç¨‹æ± ã€‚è®¿é—® <a href="https://www.nginx.com/blog/thread-pools-boost-performance-9x/">Thread Pools in NGINX Boost Performance 9x!</a> è·å–ç»†èŠ‚ã€‚</td>
</tr>
</tbody></table>
<h2 id="åŒ…å«ç¬¬ä¸‰æ–¹æ¨¡å—"><a href="#åŒ…å«ç¬¬ä¸‰æ–¹æ¨¡å—" class="headerlink" title="åŒ…å«ç¬¬ä¸‰æ–¹æ¨¡å—"></a>åŒ…å«ç¬¬ä¸‰æ–¹æ¨¡å—</h2><p>ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨è‡ªå·±çš„æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹æ¨¡å—ç¼–è¯‘ NGINX æ¥æ‰©å±• NGINX çš„åŠŸèƒ½ã€‚<a href="https://nginx.com/resources/wiki/modules/">NGINX Wiki</a> ä¸­åˆ—å‡ºäº†ä¸€äº›ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—éœ€è¦è‡ªæ‹…é£é™©ï¼Œå› ä¸ºæ— æ³•ä¿è¯å…¶ç¨³å®šæ€§ã€‚</p>
<h3 id="é™æ€é“¾æ¥æ¨¡å—"><a href="#é™æ€é“¾æ¥æ¨¡å—" class="headerlink" title="é™æ€é“¾æ¥æ¨¡å—"></a>é™æ€é“¾æ¥æ¨¡å—</h3><p>NGINX å¼€æºç‰ˆæœ¬ä¸­çš„å¤§å¤šæ•°æ¨¡å—åœ¨ç¼–è¯‘æ—¶éƒ½æ˜¯é™æ€é“¾æ¥åŒ–çš„ï¼Œåªæœ‰é‡æ–°ç¼–è¯‘æ‰å¯ä»¥ç¦ç”¨å®ƒä»¬ã€‚</p>
<p>é€šè¿‡ configure å‘½ä»¤åŒ…å« <code>--add-module=&lt;PATH&gt;</code> é€‰é¡¹ å¯ä»¥ç¼–è¯‘è¿™ç±»æ¨¡å—ï¼Œå…¶ä¸­ <PATH> æ˜¯æ¨¡å—çš„æºç è·¯å¾„ï¼ˆç¤ºä¾‹ä¸­ä¸º <a href="https://github.com/arut/nginx-rtmp-module">RTMP</a> æ¨¡å—ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure ... --add-module=/usr/build/nginx-rtmp-module</span><br></pre></td></tr></table></figure>

<h3 id="åŠ¨æ€é“¾æ¥æ¨¡å—"><a href="#åŠ¨æ€é“¾æ¥æ¨¡å—" class="headerlink" title="åŠ¨æ€é“¾æ¥æ¨¡å—"></a>åŠ¨æ€é“¾æ¥æ¨¡å—</h3><p>NGINX æ¨¡å—ä¹Ÿå¯ä»¥ç¼–è¯‘ä¸ºå…±äº«å¯¹è±¡ï¼ˆ* .so æ–‡ä»¶ï¼‰ï¼Œç„¶ååœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½åˆ° NGINX ä¸­ã€‚è¿™æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå› ä¸ºåœ¨ NGINX é…ç½®æ–‡ä»¶ä¸­å¯ä»¥éšæ—¶æ·»åŠ æˆ–åˆ é™¤ç›¸å…³çš„ <code>load_module</code> æŒ‡ä»¤å¹¶é‡æ–°åŠ è½½é…ç½®æ¥éšæ—¶åŠ è½½æˆ–å¸è½½æ¨¡å—ã€‚è¯·æ³¨æ„ï¼Œæ¨¡å—æœ¬èº«å¿…é¡»æ”¯æŒåŠ¨æ€é“¾æ¥ã€‚</p>
<p>è¦ä½¿ç”¨åŠ¨æ€åŠ è½½çš„ç¬¬ä¸‰æ–¹æ¨¡å—ç¼–è¯‘ NGINXï¼Œè¯·åœ¨ configure å‘½ä»¤ä¸­åŒ…å« <code>--add-dynamic-module=&lt;PATH&gt;</code> é€‰é¡¹ï¼Œå…¶ä¸­ <PATH> æ˜¯æ¨¡å—æºç çš„è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure ... --add-dynamic-module=&amp;lt;PATH&amp;gt;</span><br></pre></td></tr></table></figure>

<p>åŠ è½½ä¸€ä¸ªåŠ¨æ€æ¨¡å—ï¼Œè¯·åœ¨ NGINX å®‰è£…å®Œæˆååœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  load_module æŒ‡ä»¤ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">load_module</span> <span class="string">modules/ngx_mail_module.so;</span></span><br></pre></td></tr></table></figure>

<p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… NGINX åšå®¢ä¸Šçš„ <a href="https://www.nginx.com/blog/compiling-dynamic-modules-nginx-plus/">Compiling Thirdâ€‘Party Dynamic Modules for NGINX and NGINX Plus</a> ä»¥åŠ NGINX Wiki ä¸­çš„ <a href="https://nginx.com/resources/wiki/extending/">Extending NGINX</a> è¿™ä¸¤ç¯‡æ–‡ç« ã€‚</p>
<h1 id="å®Œæˆç¼–è¯‘å®‰è£…"><a href="#å®Œæˆç¼–è¯‘å®‰è£…" class="headerlink" title="å®Œæˆç¼–è¯‘å®‰è£…"></a>å®Œæˆç¼–è¯‘å®‰è£…</h1><ul>
<li>ç¼–è¯‘å®‰è£…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£…å®Œæˆåï¼ŒéªŒè¯å¹¶å¯åŠ¨ NGINXã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nginx -V</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
</search>
